<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="description" content="A fullstack, async framework for creating web applications using Clojure and Clojurescript">
<meta name="keywords" content="Clojure, Clojurescript, clj, cljs, framework, stream, web, aleph, stream processing, async, fullstack">
<meta name="author" content="Codamic Technologies">
<title>HellHound Documentation</title>
<style>
@import url("https://fonts.googleapis.com/css?family=Open+Sans");
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #3f3f3f; padding: 0; margin: 0; font-family: "Open Sans", "DejaVu Serif", serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.45; color: #c34113; font-weight: normal; margin-top: 0; margin-bottom: 0.25em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #2156a5; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #1d4b8f; }
a img { border: none; }

/* Default paragraph styles */
p { text-align: justify; font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Open Sans", "DejaVu Sans", sans-serif; font-weight: 300; font-style: normal; color: #E95420; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.0125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddddd8; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; font-weight: normal; color: rgba(0, 0, 0, 0.9); }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #3f3f3f; border-bottom: 1px dotted #ddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #ddd; }
blockquote cite { display: block; font-size: 0.9375em; color: rgba(0, 0, 0, 0.6); }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: rgba(0, 0, 0, 0.6); }

blockquote, blockquote p { line-height: 1.6; color: rgba(0, 0, 0, 0.85); }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #ddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: #fff; margin-bottom: 1.25em; border: solid 1px #dedede; }
table thead, table tfoot { background: #f7f8f7; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #3f3f3f; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #3f3f3f; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f8f8f7; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }

body { -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; word-spacing: -0.05em; }
h1 strong, h2 strong, h3 strong, #toctitle strong, .sidebarblock > .content > .title strong, h4 strong, h5 strong, h6 strong { font-weight: 400; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 0.1em 0.5ex; word-spacing: -0.15em; background-color: #f7f7f8; -webkit-border-radius: 4px; border-radius: 4px; line-height: 1.45; text-rendering: optimizeSpeed; word-wrap: break-word; }
*:not(pre) > code.nobreak { word-wrap: normal; }
*:not(pre) > code.nowrap { white-space: nowrap; }

pre, pre > code { line-height: 1.45; color: rgba(0, 0, 0, 0.9); font-family: "Droid Sans Mono", "DejaVu Sans Mono", "Monospace", monospace; font-weight: normal; text-rendering: optimizeSpeed; }

em em { font-style: normal; }

strong strong { font-weight: normal; }

.keyseq { color: #727272; }

kbd { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; display: inline-block; color: #3f3f3f; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menuref { color: #000; }

.menuseq b:not(.caret), .menuref { font-weight: inherit; }

.menuseq { word-spacing: -0.02em; }
.menuseq b.caret { font-size: 1.25em; line-height: 0.8; }
.menuseq i.caret { font-weight: bold; text-align: center; width: 0.45em; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: rgba(0, 0, 0, 0.9); }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: rgba(0, 0, 0, 0.85); margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddddd8; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddddd8; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddddd8; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: rgba(0, 0, 0, 0.6); display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: rgba(0, 0, 0, 0.85); }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: rgba(0, 0, 0, 0.85); }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: rgba(0, 0, 0, 0.85); border-bottom: 1px solid #ddddd8; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #efefed; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Open Sans", "DejaVu Sans", sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #c34113; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f8f8f7; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #efefed; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #efefed; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: #fff; padding: 1.25em; border-top: 1px solid #cececf; font-size: 0.9em; }

#footer-text { color: #3f3f3f; line-height: 1.44; }

#content { margin-bottom: 0.625em; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { #content { margin-bottom: 1.25em; }
  .sect1 { padding-bottom: 1.25em; } }
.sect1:last-child { padding-bottom: 0; }

.sect1 + .sect1 { border-top: 1px solid #efefed; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #E95420; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; font-family: "Open Sans", "DejaVu Serif", serif; font-size: 1rem; font-style: italic; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: rgba(0, 0, 0, 0.85); }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: initial; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Open Sans", "DejaVu Sans", sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddddd8; color: rgba(0, 0, 0, 0.6); }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #c34113; margin-top: 0; text-align: center; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #f7f7f8; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { -webkit-border-radius: 4px; border-radius: 4px; word-wrap: break-word; padding: 1em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #f7f7f8; background-color: rgba(0, 0, 0, 0.9); }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em; -webkit-border-radius: 4px; border-radius: 4px; }

.listingblock pre.prettyprint { border-width: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.45; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddddd8; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: rgba(0, 0, 0, 0.85); font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #c34113; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid rgba(0, 0, 0, 0.6); }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: rgba(0, 0, 0, 0.85); font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.9375em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: rgba(0, 0, 0, 0.6); }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dedede; }

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock { border-width: 0 1px 1px 0; }

table.grid-all > tfoot > tr > .tableblock { border-width: 1px 1px 0 0; }

table.grid-cols > * > tr > .tableblock { border-width: 0 1px 0 0; }

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock { border-width: 0 0 1px 0; }

table.grid-rows > tfoot > tr > .tableblock { border-width: 1px 0 0 0; }

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock { border-bottom-width: 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.6; background: #f7f8f7; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #3f3f3f; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.checklist, ul.none, ol.none, ul.no-bullet, ol.no-bullet, ol.unnumbered, ul.unstyled, ol.unstyled { list-style-type: none; }

ul.no-bullet, ol.no-bullet, ol.unnumbered { margin-left: 0.625em; }

ul.unstyled, ol.unstyled { margin-left: 0; }

ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1.25em; font-size: 0.8em; position: relative; bottom: 0.125em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.inline { display: -ms-flexbox; display: -webkit-box; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; list-style: none; margin: 0 0 0.625em -1.25em; }

ul.inline > li { margin-left: 1.25em; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0.4em 0.75em 0 0.75em; line-height: 1; vertical-align: top; }
.colist > table tr > td:first-of-type img { max-width: initial; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px #fff; -webkit-box-shadow: 0 0 0 1px #ddd; box-shadow: 0 0 0 1px #ddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; margin-left: -1.05em; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }
a span.icon > .fa { cursor: inherit; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #19407c; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #3f3f3f; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

dt, th.tableblock, td.content, div.footnote { text-rendering: optimizeLegibility; }

h1, h2, p, td.content, span.alt { letter-spacing: -0.01em; }

p strong, td.content strong, div.footnote strong { letter-spacing: -0.005em; }

p, blockquote, dt, td.content, span.alt { font-size: 1.0625rem; }

p { margin-bottom: 1.25rem; }

.sidebarblock p, .sidebarblock dt, .sidebarblock td.content, p.tableblock { font-size: 1em; }

.exampleblock > .content { background-color: #fffef7; border-color: #e0e0dc; -moz-box-shadow: 0 1px 4px #e0e0dc; -webkit-box-shadow: 0 1px 4px #e0e0dc; box-shadow: 0 1px 4px #e0e0dc; }

.imageblock .title { text-align: center; }

.print-only { display: none !important; }

@media print { @page { margin: 1.25cm 0.75cm; }
  * { -moz-box-shadow: none !important; -webkit-box-shadow: none !important; box-shadow: none !important; text-shadow: none !important; }
  a { color: inherit !important; text-decoration: underline !important; }
  a.bare, a[href^="#"], a[href^="mailto:"] { text-decoration: none !important; }
  a[href^="http:"]:not(.bare):after, a[href^="https:"]:not(.bare):after { content: "(" attr(href) ")"; display: inline-block; font-size: 0.875em; padding-left: 0.25em; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  pre, blockquote, tr, img, object, svg { page-break-inside: avoid; }
  thead { display: table-header-group; }
  svg { max-width: 100%; }
  p, blockquote, dt, td.content { font-size: 1em; orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  #toc, .sidebarblock, .exampleblock > .content { background: none !important; }
  #toc { border-bottom: 1px solid #ddddd8 !important; padding-bottom: 0 !important; }
  .sect1 { padding-bottom: 0 !important; }
  .sect1 + .sect1 { border: 0 !important; }
  #header > h1:first-child { margin-top: 1.25rem; }
  body.book #header { text-align: center; }
  body.book #header > h1:first-child { border: 0 !important; margin: 2.5em 0 1em 0; }
  body.book #header .details { border: 0 !important; display: block; padding: 0 !important; }
  body.book #header .details span:first-child { margin-left: 0 !important; }
  body.book #header .details br { display: block; }
  body.book #header .details br + span:before { content: none !important; }
  body.book #toc { border: 0 !important; text-align: left !important; padding: 0 !important; margin: 0 !important; }
  body.book #toc, body.book #preamble, body.book h1.sect0, body.book .sect1 > h2 { page-break-before: always; }
  .listingblock code[data-lang]:before { display: block; }
  #footer { background: none !important; padding: 0 0.9375em; }
  #footer-text { color: rgba(0, 0, 0, 0.6) !important; font-size: 0.9em; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
.videoblock { text-align: center; }

.videoblock iframe { border: 1px solid #bfbfbf; }

code b.conum {
  display: inline-block;
  color: #fff!important;
  background-color: rgba(0,0,0,.8);
  border-radius: 100px;
  text-align: center;
  font-size: .75em;
  width: 1.67em;
  height: 1.67em;
  line-height: 1.67em;
  font-family: "Open Sans","DejaVu Sans",sans-serif;
  font-style: normal;
  font-weight: bold;
}

.center-aligned {
  text-align: center;
}

.download-btns {
  padding-top: 20px;
  margin-bottom: 30px;
}

.lxbtn {
  border-radius: 4px;
  padding: 10px 15px;
  text-decoration: none !important;
  margin: 20px 10px;
}

.btn-primary {
  background: #e95420;
  color: white;
}

.btn-success {
  background: #772953;
  color: white;
}

.btn-success:hover, .btn-success:active, .btn-success:visited {
  color: white;
}

.btn-success:hover {
  background: #511c39;
}

.btn-info {
  background: #E29400;
  color: white;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>HellHound Documentation</h1>
<div class="details">
<span id="author" class="author">Codamic Technologies</span><br>
<span id="email" class="email">&lt;<a href="mailto:devs@codamic.tech">devs@codamic.tech</a>&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">HellHound Documentation</div>
<ul class="sectlevel1">
<li><a href="#_what_is_hellhound">1. What is HellHound?</a>
<ul class="sectlevel2">
<li><a href="#_goals">1.1. Goals</a></li>
</ul>
</li>
<li><a href="#_getting_started">2. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#_before_start">2.1. Before start</a></li>
<li><a href="#_a_little_bit_of_theory">2.2. A little bit of theory</a></li>
<li><a href="#_what_do_we_want_to_build">2.3. What do we want to build ?</a></li>
<li><a href="#_tackle_the_problem">2.4. Tackle the problem</a></li>
<li><a href="#_installation">2.5. Installation</a></li>
<li><a href="#_components">2.6. Components</a></li>
<li><a href="#_system">2.7. System</a></li>
<li><a href="#_version_2_0">2.8. Version 2.0</a></li>
</ul>
</li>
<li><a href="#systems">3. Systems</a>
<ul class="sectlevel2">
<li><a href="#_overview">3.1. Overview</a>
<ul class="sectlevel3">
<li><a href="#_the_unix_philosophy">3.1.1. The Unix Philosophy</a></li>
<li><a href="#_execution_model">3.1.2. Execution model</a></li>
<li><a href="#_workflow">3.1.3. Workflow</a></li>
</ul>
</li>
<li><a href="#components">3.2. Components</a>
<ul class="sectlevel3">
<li><a href="#_advantages_of_the_component_model">3.2.1. Advantages of the Component Model</a></li>
<li><a href="#_disadvantages_of_the_component_model">3.2.2. Disadvantages of the Component Model</a></li>
<li><a href="#_usage">3.2.3. Usage</a></li>
<li><a href="#_context_map">3.2.4. Context Map</a></li>
</ul>
</li>
<li><a href="#workflow">3.3. Workflow</a>
<ul class="sectlevel3">
<li><a href="#_conditional_workflow">3.3.1. Conditional Workflow</a></li>
</ul>
</li>
<li><a href="#_examples">3.4. Examples</a>
<ul class="sectlevel3">
<li><a href="#_very_simple_system">3.4.1. Very Simple System</a></li>
<li><a href="#_simple_workflow">3.4.2. Simple workflow</a></li>
<li><a href="#_conditional_workflow_2">3.4.3. Conditional Workflow</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_buil_in_components">4. Buil-in Components</a></li>
<li><a href="#_http">5. HTTP</a>
<ul class="sectlevel2">
<li><a href="#_overview_2">5.1. Overview</a>
<ul class="sectlevel3">
<li><a href="#_installation_2">5.1.1. Installation</a></li>
<li><a href="#_building_blocks">5.1.2. Building blocks</a></li>
<li><a href="#_recommended_solution">5.1.3. Recommended solution</a></li>
</ul>
</li>
<li><a href="#_http_router">5.2. HTTP Router</a>
<ul class="sectlevel3">
<li><a href="#_routes_vs_routers">5.2.1. Routes vs. Routers</a></li>
<li><a href="#_routes">5.2.2. Routes</a></li>
<li><a href="#_verbose_syntax">5.2.3. Verbose Syntax</a></li>
<li><a href="#_table_syntax">5.2.4. Table Syntax</a></li>
<li><a href="#_terse_syntax">5.2.5. Terse Syntax</a></li>
</ul>
</li>
<li><a href="#_routers">5.3. Routers</a>
<ul class="sectlevel3">
<li><a href="#_custom_router">5.3.1. Custom Router</a></li>
</ul>
</li>
<li><a href="#_examples_2">5.4. Examples</a>
<ul class="sectlevel3">
<li><a href="#_echo_server">5.4.1. Echo Server</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_prerequisite">Appendix A: Prerequisite</a>
<ul class="sectlevel2">
<li><a href="#_commander_pattern">A.1. Commander Pattern</a></li>
<li><a href="#_manifold">A.2. Manifold</a></li>
<li><a href="#_deferred">A.3. Deferred</a>
<ul class="sectlevel3">
<li><a href="#_composing_with_deferreds">A.3.1. composing with deferreds</a></li>
<li><a href="#_let_flow">A.3.2. let-flow</a></li>
<li><a href="#_custom_execution_models">A.3.3. custom execution models</a></li>
</ul>
</li>
<li><a href="#_stream">A.4. Stream</a>
<ul class="sectlevel3">
<li><a href="#_stream_operators">A.4.1. stream operators</a></li>
<li><a href="#_connecting_streams">A.4.2. connecting streams</a></li>
<li><a href="#_buffers_and_backpressure">A.4.3. buffers and backpressure</a></li>
<li><a href="#_event_buses_and_publish_subscribe_models">A.4.4. event buses and publish/subscribe models</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_contributing_to_hellhound">Appendix B: Contributing to HellHound</a>
<ul class="sectlevel2">
<li><a href="#_looking_for_work">B.1. Looking for work?</a></li>
<li><a href="#_new_features">B.2. New Features</a></li>
<li><a href="#_bugs">B.3. Bugs</a></li>
<li><a href="#_tests">B.4. Tests</a></li>
</ul>
</li>
<li><a href="#_contributor_covenant_code_of_conduct">Appendix C: Contributor Covenant Code of Conduct</a>
<ul class="sectlevel2">
<li><a href="#_our_pledge">C.1. Our Pledge</a></li>
<li><a href="#_our_standards">C.2. Our Standards</a></li>
<li><a href="#_our_responsibilities">C.3. Our Responsibilities</a></li>
<li><a href="#_scope">C.4. Scope</a></li>
<li><a href="#_enforcement">C.5. Enforcement</a></li>
<li><a href="#_attribution">C.6. Attribution</a></li>
</ul>
</li>
<li><a href="#_colophon">Colophon</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Under development software</div>
<div class="paragraph">
<p>This software is in Alpha stage. It&#8217;s under heavy development
and reaches the Beta stage pretty soon. If you like to be part of this process please
leave us a message.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="https://github.com/Codamic/hellhound/raw/master/assets/hellhound-white.png" alt="HellHound">
</div>
</div>
<div class="center-aligned download-btns">
<a href="/guides/hellhound.pdf" class="lxbtn btn-success">
   <i class="fa fa-download"></i>
   PDF
</a>

<a href="/guides/hellhound.epub" class="lxbtn btn-success">
   <i class="fa fa-download"></i>
   EPUB
</a>

<a href="/guides/hellhound.mobi" class="lxbtn btn-success">
   <i class="fa fa-download"></i>
   MOBI
</a>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_hellhound"><a class="anchor" href="#_what_is_hellhound"></a>1. What is HellHound?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>HellHound</strong> is a set of libraries to create simple and elegant programs based on streams. An <strong>HellHound</strong> application
basically is a <a href="#systems">system</a> of <a href="#components">components</a> which work together in order to achieve a common goal.
Components form one or more data pipelines through <a href="#workflow">workflows</a>. In general systems are a great way to
manage the lifecycle and data flow or your program and components are awesome for managing the state and dependencies
of different pieces of your program.</p>
</div>
<div class="sect2">
<h3 id="_goals"><a class="anchor" href="#_goals"></a>1.1. Goals</h3>
<div class="paragraph">
<p>The ultimate goal of <strong>HellHound</strong> is to create a set of libraries for creating well orginized, simple, easy to test, easy to
to scale and distribute applications using Clojure and Clojurescipt around streams and data pipelines.</p>
</div>
<div class="paragraph">
<p>Another goal of this project is to create a tool which allows developers to focus on their business logic as much as possible
while <strong>HellHound</strong> takes care of different aspects of their distributed and scalable software in an opinionated way. We want
to achieve this using different component which provides these kind of tasks.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>2. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before continue with document please make sure the you know enough about <a href="#_prerequisite">HellHound prerequisite</a>.</p>
</div>
<div class="paragraph">
<p>In this section we&#8217;re going to build an example application to cover some the most important concepts
and features of HellHound.</p>
</div>
<div class="paragraph">
<p>In order to continue with this section you need to have <a href="https://leiningen.org/">Leiningen</a> setup in your
box.</p>
</div>
<div class="paragraph">
<p>The final application is available at <a href="https://github.com/lxsameer/hellhound_examples">this github repository</a> and
under the <code>getting-started</code> namespace.</p>
</div>
<div class="sect2">
<h3 id="_before_start"><a class="anchor" href="#_before_start"></a>2.1. Before start</h3>
<div class="paragraph">
<p>The aim of this tutorial is to given you a rough overview about the <strong>HellHound</strong> systems. In order to continue
with this tutorial you should know about <a href="http://clojure.org/">clojure</a> and <a href="https://leiningen.org/">Leiningen</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_little_bit_of_theory"><a class="anchor" href="#_a_little_bit_of_theory"></a>2.2. A little bit of theory</h3>
<div class="paragraph">
<p>In order to have easier time reading this tutorial, I&#8217;m going to give you a brief introduction about some of the
concepts we&#8217;re going to use in this tutorial. You can read more about each of these concepts in more details later
in their own sections.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>System</strong>:
It&#8217;s a hashmap describing our application system. Basically how it should work. <a href="#systems">Learn More.</a></p>
</li>
<li>
<p><strong>Component</strong>:
  A system is create by a set of components. You can think of a component as a unix command or a function ( they
are more than a function though ). Just like a unix command each component has a input and output. <a href="#components">Learn More</a></p>
</li>
<li>
<p><strong>Workflow</strong>: A workflow is a graph like data structure which defines the data flow of the system. Simply describes how to pipe
the output of a component to input of another component.<a href="#workflow">Learn More</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_what_do_we_want_to_build"><a class="anchor" href="#_what_do_we_want_to_build"></a>2.3. What do we want to build ?</h3>
<div class="paragraph">
<p>In order to gain an overview of HellHound systems we&#8217;re going to build a real world application together. In this
example we&#8217;re going to create a simple web proxy application which gets a domain name and a port number, setup a
webserver to serve the content of the given domain name and serve it locally.</p>
</div>
<div class="paragraph">
<p><strong>HellHound is library to create data pipelines.</strong> Basically data pipelines are suitable for stream processing and
those use cases which involve with data streams. <strong>But I chose the proxy use case intentionally to demonstrate
the usage of HellHound for a use case which is not a case of stream processing by default.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_tackle_the_problem"><a class="anchor" href="#_tackle_the_problem"></a>2.4. Tackle the problem</h3>
<div class="paragraph">
<p>For this specific usage case web need to spin up a webserver which listens to a port for any HTTP URL and contructs new
requests from the incoming requests with different host ( the remote host ) and sent them to the actual host and response
back to user with the reponses fetch from the remote host.</p>
</div>
<div class="paragraph">
<p>So we&#8217;re going to create a system hashmap with two component. A <code>webserver</code> component and a <code>loader</code> component. As the name
suggests <code>webserver</code> component should be responsible for getting the user requests and serving responses to the user. The
<code>loader</code> component should fetch the url content from the remote host. In this system we want to connect the output of
<code>webserver</code> to the input of <code>loader</code> and connect the output of <code>loader</code> to input of <code>webserver</code>. So we&#8217;re going to end
up with a closed system.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s get our feet wet.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installation"><a class="anchor" href="#_installation"></a>2.5. Installation</h3>
<div class="paragraph">
<p>Add <strong>HellHound</strong> to your dependencies as follow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">[codamic/hellhound <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.0-alpha3</span><span class="delimiter">&quot;</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>codamic/hellhound</code> is a meta package which automatically install serveral HellHound libraries like <code>codamic/hellhound.core</code>
and <code>codamic/hellhound.http</code>. So your can only install an specific library that you need instead of using <code>codamic/hellhound</code>.
For instance you might not need the <code>codamic/hellhound.i18n</code> library or <code>codamic/hellhound.http</code> so you can just install
<code>codamic/hellhound.core</code>. Systems are part of <code>codamic/hellhound.core</code> artifact.</p>
</div>
</div>
<div class="sect2">
<h3 id="_components"><a class="anchor" href="#_components"></a>2.6. Components</h3>
<div class="paragraph">
<p>Lets start with <a href="#components">components</a> creation. HellHound&#8217;s components are just hashmaps. Simple, good old hashmaps.
Any component map should contains at least three keys, <code>:hellhound.component/name</code>, <code>:hellhound.component/start-fn</code> and
<code>:hellhound.component/stop-fn</code>. The value of the <code>:hellhound.component/name</code> key should be a namespaced keyword which is
the component name. We use this name to refer to the component later in our system configuration. the value  of
<code>:hellhound.component/start-fn</code> should be function that takes two arguments. The first argument is the component hashmap
itself and the second argument is another hashmap which is called context map (In order to learn more about components
in details, please checkout the <a href="#components">components section of this documentation</a>). The main logic of the component
goes into this function. It should return a component map again. The <code>:hellhound.component/stop-fn</code> function is similar
to <code>start-fn</code> but accept only one argument which is the component map itself. This function is responsible for tearing down
the logic of the component and do the clean up. For example, close the connection which has been opened on <code>start-fn</code> or similar
stuff.</p>
</div>
<div class="paragraph">
<p>Ok, It&#8217;s time to write some code. Let&#8217;s start with a really basic component skeleton for the <code>webserver</code> component.
Check out the following code.</p>
</div>
<div class="listingblock">
<div class="title">Basic skeleton for a component</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td>
  <td class="code"><pre>(<span class="keyword">ns</span> <span class="namespace">getting-started.proxy.components.web</span>
  (<span class="symbol">:require</span> [hellhound.component <span class="symbol">:as</span> component])) <i class="conum" data-value="1"></i><b>(1)</b>

(<span class="keyword">defn</span> <span class="function">start-fn</span>   <i class="conum" data-value="2"></i><b>(2)</b>
  [this context]
  this)

(<span class="keyword">defn</span> <span class="function">stop-fn</span>    <i class="conum" data-value="3"></i><b>(3)</b>
  [this]
  this)

(<span class="keyword">defn</span> <span class="function">factory</span>   <i class="conum" data-value="4"></i><b>(4)</b>
  []
  (component/make-component <span class="symbol">::server</span> start-fn stop-fn)) <i class="conum" data-value="5"></i><b>(5)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In order to use <code>make-component</code> function we need the <code>hellhound.component</code> ns.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#_component_start_fn">start-fn</a> is the entry point to each component logic. Simply think of it
as the place where you have to implement the logic behind your component. In this case our <code>start-fn</code>
does nothing.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><a href="#_component_start_fn">start-fn</a> is responsible for component termination logic, mostly cleanup. For instance,
closing a socket, flushing data do disk and so on.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Factory function is a simple function to create instances of our component with different configuration. In this
case we just creates a fix component map. Nothing special.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>make-component</code> function is just a shortcut function to create the component map easily. We can replace it by
the actual hashmap definition of the component. We passed <code>::server</code> as the first argument to this function which
is the name of our component. Component&#8217;s name should be namespaced keyword.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Almost all of the components that you may encounter or create, will have the same skeleton. Let&#8217;s go over the basics of
a component again. Each component has a name which must be a namespaced keyword, a <code>start-fn</code> with holds the logic of the
component and gets two arguments, the component map itself and a context map, and should return a component map, a <code>stop-fn</code>
that gets a component map and holds the termination logic. Every component has an input stream and an output stream defined
in their component-map. There are more details about components which you can read in <a href="#components">components section</a>.</p>
</div>
<div class="paragraph">
<p>HellHound created around and shares similar ideas as <a href="#_the_unix_philosophy">unix philosophy</a>. Components are isolated
unix of execution which read data from their input, process the data and write the result to the output. System makes a
data pipeline by pipeing IO of different components to one another. You&#8217;ll learn more about this concept later on this
documentation.</p>
</div>
<div class="paragraph">
<p>Now that we setup a very basic component and we have better understanding about component concept. let&#8217;s focus on the
webserver logic and create a real world webserver component.</p>
</div>
<div class="listingblock">
<div class="title">Web server component.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td>
  <td class="code"><pre>(<span class="keyword">ns</span> <span class="namespace">getting-started.proxy.components.web</span> <i class="conum" data-value="1"></i><b>(1)</b>
  (<span class="symbol">:require</span> [aleph.http <span class="symbol">:as</span> http]   <i class="conum" data-value="2"></i><b>(2)</b>
            [hellhound.component <span class="symbol">:as</span> hcomp]
            [manifold.stream <span class="symbol">:as</span> stream]  <i class="conum" data-value="3"></i><b>(3)</b>
            [manifold.deferred <span class="symbol">:as</span> d])) <i class="conum" data-value="4"></i><b>(4)</b>


(<span class="keyword">defn</span> <span class="function">handler</span>       <i class="conum" data-value="5"></i><b>(5)</b>
  [input output]
  (stream/consume #(d/success!     <i class="conum" data-value="6"></i><b>(6)</b>
                    (<span class="symbol">:response-deferred</span> %)
                    (<span class="symbol">:response</span> %))
                  input)
  (<span class="keyword">fn</span> [req]               <i class="conum" data-value="7"></i><b>(7)</b>
    (<span class="keyword">let</span> [response (d/deferred)]     <i class="conum" data-value="8"></i><b>(8)</b>
      (stream/put! output {<span class="symbol">:request</span> req    <i class="conum" data-value="9"></i><b>(9)</b>
                           <span class="symbol">:response-deferred</span> response})
      response)))

(<span class="keyword">defn</span> <span class="function">start!</span>   <i class="conum" data-value="10"></i><b>(10)</b>
  [port]
  (<span class="keyword">fn</span> [this context]
    (<span class="keyword">let</span> [[input output] (hcomp/io this)]    <i class="conum" data-value="11"></i><b>(11)</b>
      (<span class="keyword">assoc</span> this
             <span class="symbol">:server</span>
             (http/start-server (handler input output) {<span class="symbol">:port</span> port})))))   <i class="conum" data-value="12"></i><b>(12)</b>

(<span class="keyword">defn</span> <span class="function">stop!</span>  <i class="conum" data-value="13"></i><b>(13)</b>
  <span class="string"><span class="delimiter">&quot;</span><span class="content">Stops the running webserver server.</span><span class="delimiter">&quot;</span></span>
  [this]
  (<span class="keyword">if</span> (<span class="symbol">:server</span> this)
    (<span class="keyword">do</span>
      (<span class="keyword">.</span>close (<span class="symbol">:server</span> this))    <i class="conum" data-value="14"></i><b>(14)</b>
      (<span class="keyword">dissoc</span> this <span class="symbol">:server</span>))     <i class="conum" data-value="15"></i><b>(15)</b>
    this))


(<span class="keyword">defn</span> <span class="function">factory</span>
  [{<span class="symbol">:keys</span> [port] <span class="symbol">:as</span> config}] <i class="conum" data-value="16"></i><b>(16)</b>
  (hcomp/make-component <span class="symbol">::server</span> (start! port) stop!)) <i class="conum" data-value="17"></i><b>(17)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Namespace definition. As you can see we orginized the <code>web</code> component under <code>getting-started.proxy.components</code>
namespace. It is a good practice to store all of your components under the same parent namespace.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We&#8217;re going to use the awesome <a href="http://aleph.io(Aleph" class="bare">http://aleph.io(Aleph</a>) library to build our webserver. HellHound depends on this
library by default (If we use the <code>codamic/hellhound</code> or <code>codamic/hellhound.http</code> artifact).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>manifold.stream</code> library provides a very robust stream abstraction. Component&#8217;s IO build around this abstraction
and we need to use this library to work with component&#8217;s IO. HellHound depends on the <code>manifold</code> library, so there&#8217;s
no need to add it explicitly to your dependencies.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>manifold.deferred</code> library provides an abstraction around promises and futures, and aleph webserver uses them as
async responses.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The return value of this function is in fact the ring handler which we want to use to handle the incoming requests.
The two paramter of <code>handler</code> function are the <code>input</code> and <code>output</code> of the webserver component.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Before we return the actual ring handler, we need to setup a consumer for incoming data from the input stream.
The basic idea is to treat any incoming data from the <code>input</code> stream of webserver component as a response and
return the response to the user. Alph support async responses using deferreds, So by returning a deferred
from <strong>(8)</strong> alph send back the response as soon as the deferred realised. In our consumer we just extract the same
deferred value from the incoming map ( any incoming value is a hashmap and we placed the deferred into it in <strong>(9)</strong>)
and resolve it the response map that again extracted from the same hashmap.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The actual ring handler that receives the HTTP request hashmap (<code>req</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Created a deferred value to use as the response and pass it through the pipeline.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Simply create a hashmap containing <code>:request</code> and <code>:response-deferred</code> with the corresponding values and put the
hashmap into the webserver output stream (send it down to the pipeline). Then, return the created deferred so
alph can return the reponse to user as soon as the response deferred realise.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Receives a port number and return an anonymous function to be used as a start function for webserver component.
It passes the given port number to the <code>start-server</code> function of aleph.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td><code>hellhound.component/io</code> function is a helper function which returns a vector in form of <code>[input output]</code> of
the IO streams of the given component.</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Starts the aleph webserver. As you can see we passed the input and output of the component to <code>handler</code> fn.
We assigned the returned value of <code>start-server</code> to a key in component map so we can close it later.</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td><code>stop-fn</code> of the webserver component.</td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td>Stop the aleph server by calling <code>.close</code> on the server object which we assigned to <code>:server</code> in the <code>start-fn</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="15"></i><b>15</b></td>
<td>Remove the <code>:server</code> key to get back to the initial state.</td>
</tr>
<tr>
<td><i class="conum" data-value="16"></i><b>16</b></td>
<td>Desctruct the port number from the given <code>config</code> map.</td>
</tr>
<tr>
<td><i class="conum" data-value="17"></i><b>17</b></td>
<td>Create and return a component map for with the name of <code>::server</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So far we created a webserver component which its output is a stream of hashmaps that each of them has a <code>:request</code> key
containing the request map and conceptually it will send any incoming response from the input stream to user.</p>
</div>
<div class="paragraph">
<p>Now we need another component to fetch the content of each requested URL from the remote host. Let&#8217;s jump in:</p>
</div>
<div class="listingblock">
<div class="title">Crawler component.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td>
  <td class="code"><pre>(<span class="keyword">ns</span> <span class="namespace">getting-started.proxy.components.crawler</span>
  (<span class="symbol">:require</span>
   [aleph.http <span class="symbol">:as</span> http]   <i class="conum" data-value="1"></i><b>(1)</b>
   [manifold.deferred <span class="symbol">:as</span> d]
   [manifold.stream <span class="symbol">:as</span> stream]
   [hellhound.component <span class="symbol">:as</span> component]))



(<span class="keyword">defn</span> <span class="function">response</span>     <i class="conum" data-value="2"></i><b>(2)</b>
  [res]
  {<span class="symbol">:status</span> (<span class="symbol">:status</span> res)
   <span class="symbol">:headers</span> (<span class="symbol">:headers</span> res)
   <span class="symbol">:body</span> (<span class="symbol">:body</span> res)})

(<span class="keyword">defn</span> <span class="function">fetch-url</span>
  [url]
  (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">PROXYING '</span><span class="delimiter">&quot;</span></span> url <span class="string"><span class="delimiter">&quot;</span><span class="content">'...</span><span class="delimiter">&quot;</span></span>)
  (d/chain (http/get url)    <i class="conum" data-value="3"></i><b>(3)</b>
           response))

(<span class="keyword">defn</span> <span class="function">proxy</span>   <i class="conum" data-value="4"></i><b>(4)</b>
  [output host]
  (<span class="keyword">fn</span> [event]
    (<span class="keyword">let</span> [request (<span class="symbol">:request</span> event)
          url     (<span class="keyword">str</span> host (<span class="symbol">:uri</span> request))]
      (stream/put! output                        <i class="conum" data-value="5"></i><b>(5)</b>
                   (<span class="keyword">assoc</span> event
                          <span class="symbol">:response</span>
                          (fetch-url url))))))   <i class="conum" data-value="6"></i><b>(6)</b>

(<span class="keyword">defn</span> <span class="function">start</span>
  [host]
  (<span class="keyword">fn</span> [this context]
    (<span class="keyword">let</span> [[input output] (component/io this)]     <i class="conum" data-value="7"></i><b>(7)</b>
     (stream/consume (<span class="keyword">proxy</span> output host) input)   <i class="conum" data-value="8"></i><b>(8)</b>
     this)))

(<span class="keyword">defn</span> <span class="function">stop</span> [this] this)   <i class="conum" data-value="9"></i><b>(9)</b>

(<span class="keyword">defn</span> <span class="function">factory</span>
  [host]
  (component/make-component <span class="symbol">::job</span> (start host) stop))  <i class="conum" data-value="10"></i><b>(10)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Yupe, aleph again. Aleph library provides a HTTP client as well.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A simple an stupid function to extract data from the response and generate a ring response again. This function is
useless in this case but You might want to change the response a bit. In that case this function would be
the best place for your logic.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Fetch the content of the given url and uses the <code>manifold.deferred/chain</code> function to pass the content to <code>response</code>
function as soon as it arrived. <code>manifold.deferred/chain</code> returns a <code>deferred</code> value.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Returns an anonymous function with gets a parameter that would be any incoming value from the input stream. Then, we
we extract the request from the incoming value and fetch the content for that request.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Fetch the content or <code>url</code> by using <code>fetch-url</code> function and creates a new hashmap from the received input data with
an additional key called <code>:response</code> that has a deferred value representing the content and push it to the output of
crawler component.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Retrieve the content of the given <code>url</code>. The return value of this function is a deferred value.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><code>hellhound.component/io</code> is a helper function that returns input and output of the given component.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Consumes any incoming value from the input and uses the function returned by the <code>proxy</code> function to process each
value.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>A dummy stop funtion which does nothing. Because we don&#8217;t have any termination or cleanup logic.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Creates a new component with name <code>:getting-started.proxy.components.crawler/job</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alright, Now we have two components that we can create a system from them and build our proxy.</p>
</div>
</div>
<div class="sect2">
<h3 id="_system"><a class="anchor" href="#_system"></a>2.7. System</h3>
<div class="paragraph">
<p>HellHound&#8217;s systems are the most important part of our application. We express our thoughts on how the application
should behave using systems.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create the first version of our system and then talk about a little bit of details.</p>
</div>
<div class="listingblock">
<div class="title">Crawler component.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td>
  <td class="code"><pre>(<span class="keyword">ns</span> <span class="namespace">getting-started.proxy.system</span>
  (<span class="symbol">:require</span>
   [getting-started.proxy.components.web <span class="symbol">:as</span> web] <i class="conum" data-value="1"></i><b>(1)</b>
   [getting-started.proxy.components.crawler <span class="symbol">:as</span> crawler])) <i class="conum" data-value="2"></i><b>(2)</b>


<span class="comment">;; System factory</span>
(<span class="keyword">defn</span> <span class="function">factory</span> <i class="conum" data-value="3"></i><b>(3)</b>
  [port host]
  {<span class="symbol">:components</span>                       <i class="conum" data-value="4"></i><b>(4)</b>
        [(web/factory {<span class="symbol">:port</span> port})  <i class="conum" data-value="5"></i><b>(5)</b>
         (crawler/factory host)]     <i class="conum" data-value="6"></i><b>(6)</b>

   <span class="symbol">:workflow</span>                             <i class="conum" data-value="7"></i><b>(7)</b>
        [[<span class="symbol">::web/server</span> <span class="symbol">::crawler/job</span>]    <i class="conum" data-value="8"></i><b>(8)</b>
         [<span class="symbol">::crawler/job</span> <span class="symbol">::web/server</span>]})  <i class="conum" data-value="9"></i><b>(9)</b>
</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Our webserver component.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Our crawler component.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A system factory function which gets the configuration of the system and returns a system map based on those values.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Each system must have a <code>:components</code> key with a collection of components as the value.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We created an instance of webserver component by calling the factory function of web namespace and passing the webserver
configuration to it. We can refer to this component later using its name which we defined in the web ns.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Same as webserver component we created an instance of the crawler.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Every system must have a <code>:workflow</code> key as well. This key describes how HellHound should create the data pipeline by
pipeing IO of components together. Its value should be a collection of collections which each element represent a
connection.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>In this connection we want to plug the output stream of <code>::web/server</code> (which is the name of our webserver component) to
input stream of <code>::crawler/job</code> (which is the name of our crawler component). So any value that goes to <code>::web/server</code>
output would be available to <code>::crawler/job</code> through its input stream.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>In this connection we connect <code>::crawler/job</code> back to <code>::web/server</code>. So values from crawler&#8217;s output will goes to
webserver input stream.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see, system definition is fairly straight forward. HellHound starts all the components by calling their
start function first and the setup the data pipeline based on the <code>:workflow</code> description.</p>
</div>
<div class="paragraph">
<p>In our example by sending a request to our webserver, the <code>::web/server</code> component will process the request and send to
to the its output and the request would endup in the input of <code>::crawler/job</code>. Then crawler fetches the content of any
incoming request and put it to its output that according to the <code>:workflow</code>, its output connected to the input of
<code>::web/server</code>. Webserver component will send back in value coming from the input stream to user as response. Pretty simple,
isn&#8217;t it ?</p>
</div>
<div class="paragraph">
<p>Systems decouple the logic of the program in to smaller pieces (components). It&#8217;s easier to reason about each piece and
it&#8217;s much easier to replace a piece with another piece. Due to input/output abstraction systems are highly composable
and components are heavily reusable.</p>
</div>
<div class="paragraph">
<p>Now it&#8217;s time to use our system and run our program. Here is our <code>core</code> namespace and main function:</p>
</div>
<div class="listingblock">
<div class="title">Core namespace.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre>(<span class="keyword">ns</span> <span class="namespace">getting-started.proxy.core</span>
  (<span class="symbol">:require</span> [getting-started.proxy.system <span class="symbol">:as</span> system]
            [hellhound.system <span class="symbol">:as</span> hellhound]
            [aleph.http <span class="symbol">:as</span> http])
  (<span class="symbol">:gen-class</span>))


(<span class="keyword">defn</span> <span class="function">-main</span>
  [&amp; args]
  (<span class="keyword">let</span> [[url _port path] args
        port             (Integer. (<span class="keyword">or</span> _port <span class="string"><span class="delimiter">&quot;</span><span class="content">3000</span><span class="delimiter">&quot;</span></span>))]

    (<span class="keyword">if</span> (<span class="keyword">nil?</span> url)
      (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">URL is missing. Please pass the 3rd party URL as the first arg</span><span class="delimiter">&quot;</span></span>)
      (<span class="keyword">let</span> [proxy-system (system/factory port url)]       <i class="conum" data-value="1"></i><b>(1)</b>
        (<span class="keyword">println</span> (<span class="keyword">str</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Starting server on </span><span class="delimiter">&quot;</span></span> port <span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>))
        (hellhound/set-system! proxy-system)              <i class="conum" data-value="2"></i><b>(2)</b>
        (hellhound/start!)))))                            <i class="conum" data-value="3"></i><b>(3)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create an instance of our system by passing the configuration to the factory function.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the default system of our program. Each program can have only one default system at any given time.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Fire up the default system (start the program).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now it&#8217;s time to run our program using lein. Issue the following command in the project root:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>lein run -m getting-started.proxy.core/-main http://hellhound.io 3000</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or if you&#8217;re using your own project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>lein run http://hellhound.io 3000</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Open up your browser and navigate to <a href="http://localhost:3000/(http://localhost:3000/" class="bare">http://localhost:3000/(http://localhost:3000/</a>). You should be able to see HellHound&#8217;s
website loading using your proxy.</p>
</div>
</div>
<div class="sect2">
<h3 id="_version_2_0"><a class="anchor" href="#_version_2_0"></a>2.8. Version 2.0</h3>
<div class="paragraph">
<p>Let&#8217;s improve our code so we can serve the index of the website locally and through a file (Actually I personally use this
software on my daily development). But first, let&#8217;s think about what we want to do. Generally in order to do such thing,
we should look into the <code>:uri</code> value inside the request map of a ring handler. If it is <code>/</code> we need to load the content
from a file instead of sending a request to the remote host. We need to treat other URIs the same as before.</p>
</div>
<div class="paragraph">
<p>We can use system&#8217;s workflow to achieve our goal. But we need more components. Let&#8217;s create a component which loads
the index content from a file.</p>
</div>
<div class="listingblock">
<div class="title">Index loader component</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td>
  <td class="code"><pre>(<span class="keyword">ns</span> <span class="namespace">getting-started.proxy.components.index-loader</span>
  (<span class="symbol">:require</span>
   [manifold.stream <span class="symbol">:as</span> stream]
   [hellhound.component <span class="symbol">:as</span> component]))


(<span class="keyword">defn</span> <span class="function">response</span>
  [body]
  {<span class="symbol">:body</span> body <span class="symbol">:status</span> <span class="integer">200</span> <span class="symbol">:headers</span> []})


(<span class="keyword">defn</span> <span class="function">load-index</span>   <i class="conum" data-value="1"></i><b>(1)</b>
  [output]
  (<span class="keyword">fn</span> [event]      <i class="conum" data-value="2"></i><b>(2)</b>
    (<span class="keyword">let</span> [path (System/getProperty <span class="string"><span class="delimiter">&quot;</span><span class="content">user.dir</span><span class="delimiter">&quot;</span></span>)  <i class="conum" data-value="3"></i><b>(3)</b>
          file (<span class="keyword">str</span> path <span class="string"><span class="delimiter">&quot;</span><span class="content">/index.html</span><span class="delimiter">&quot;</span></span>)]        <i class="conum" data-value="4"></i><b>(4)</b>
      (<span class="keyword">println</span> (<span class="keyword">str</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Loading: </span><span class="delimiter">&quot;</span></span> file))

      (stream/put!
       output
       (<span class="keyword">assoc</span> event <span class="symbol">:index-content</span> (<span class="keyword">slurp</span> file)))))) <i class="conum" data-value="5"></i><b>(5)</b>

(<span class="keyword">defn</span> <span class="function">start!</span>
  [this context]
  (<span class="keyword">let</span> [[input output] (component/io this)]
    (stream/consume (load-index output) input)   <i class="conum" data-value="6"></i><b>(6)</b>
    this))

(<span class="keyword">defn</span> <span class="function">stop</span> [this] this)

(<span class="keyword">defn</span> <span class="function">factory</span>
  []
  (component/make-component <span class="symbol">::job</span> start! stop))  <i class="conum" data-value="7"></i><b>(7)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Returns a function that process any incoming value from the input and but the result to output stream</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>event</code> will hold each of the incoming values.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get the home directory of the user.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Set the file path to <code>$HOME/index.html</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Reads the content of the <code>file</code> and assign it to a new key in the map. Send the map to the output.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Consumes any incoming value and process them using the anonymous function returned by <code>load-index</code> fn.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Creates a component and call it  <code>::job</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now just for fun let&#8217;s create another component which reads from the input stream and construct a ring response from
any incoming value and put the generate ring response to the output stream. Totally simple and easy to build.</p>
</div>
<div class="listingblock">
<div class="title">Response generator component</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td>
  <td class="code"><pre>(<span class="keyword">ns</span> <span class="namespace">getting-started.proxy.components.response</span>
  (<span class="symbol">:require</span> [hellhound.component <span class="symbol">:as</span> component]
            [manifold.stream <span class="symbol">:as</span> stream]))


(<span class="keyword">defn</span> <span class="function">make-response</span>
  [output]
  (<span class="keyword">fn</span> [{<span class="symbol">:keys</span> [index-content] <span class="symbol">:as</span> event}]
    (stream/put! output
                 (<span class="keyword">assoc</span> event <span class="symbol">:response</span> {<span class="symbol">:body</span> index-content
                                         <span class="symbol">:headers</span> []
                                         <span class="symbol">:status</span> <span class="integer">200</span>}))))

(<span class="keyword">defn</span> <span class="function">-&gt;response</span>
  [this context]
  (<span class="keyword">let</span> [[input output] (component/io this)]
    (stream/consume (make-response output) input)
    this))

(<span class="keyword">defn</span> <span class="function">-&gt;response-factory</span>
  []
  (component/make-component <span class="symbol">::-&gt;response</span> -&gt;response #(<span class="keyword">identity</span> %))) <i class="conum" data-value="1"></i><b>(1)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Let&#8217;s call this component <code>::&#8594;response</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you see, the response generator component is very very simple.</p>
</div>
<div class="paragraph">
<p>Now It is time to improve our system and workflow.</p>
</div>
<div class="listingblock">
<div class="title">Response generator component</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
  <td class="code"><pre>(<span class="keyword">ns</span> <span class="namespace">getting-started.proxy.system</span>
  (<span class="symbol">:require</span>
   [getting-started.proxy.components.web <span class="symbol">:as</span> web]
   [getting-started.proxy.components.crawler <span class="symbol">:as</span> crawler]
   [getting-started.proxy.components.index-loader <span class="symbol">:as</span> loader]
   [getting-started.proxy.components.response <span class="symbol">:as</span> response]))

(<span class="keyword">defn</span> <span class="function">uri</span>     <i class="conum" data-value="1"></i><b>(1)</b>
  [event]
  (<span class="symbol">:uri</span> (<span class="symbol">:request</span> event)))

(<span class="keyword">defn</span> <span class="function">factory</span>
  [port host]
  {<span class="symbol">:components</span> [(web/factory {<span class="symbol">:port</span> port})
                (crawler/factory host)
                (loader/factory)
                (response/-&gt;response-factory)]

   <span class="symbol">:workflow</span> [[<span class="symbol">::web/server</span> #(<span class="keyword">not</span> (<span class="keyword">=</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> (uri %))) <span class="symbol">::crawler/job</span>]   <i class="conum" data-value="2"></i><b>(2)</b>
              [<span class="symbol">::web/server</span> #(<span class="keyword">=</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> (uri %))       <span class="symbol">::loader/job</span>]    <i class="conum" data-value="3"></i><b>(3)</b>
              [<span class="symbol">::crawler/job</span> <span class="symbol">::web/server</span>]                          <i class="conum" data-value="4"></i><b>(4)</b>
              [<span class="symbol">::loader/job</span>  <span class="symbol">::response/-&gt;response</span>]                 <i class="conum" data-value="5"></i><b>(5)</b>
              [<span class="symbol">::response/-&gt;response</span> <span class="symbol">::web/server</span>]]})               <i class="conum" data-value="6"></i><b>(6)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A helper function that extract the uri from the ring request map.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In this connection we want all the values which their <code>:uri</code> value is not <code>/</code> to go to <code>::crawler/job</code> component from
<code>::web/server</code>. The second value in the connection collection (if total number of values in the connection collection
is more than two) is a predicate function. If that predicate returns true only then values will pass to downstream
component.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>By the predicate of this connection, only requests which has <code>/</code> as the <code>:uri</code> value passes down to the downstream
component that is <code>::loader/job</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Same as before, we want the output of <code>::crawler/job</code> to be connected to input of <code>::webserver</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Connects the output of <code>::loader/job</code> to input of <code>::response/&#8594;response</code>. This step might be un-necessary we could
just do it in the same component but just to have more complicated workflow, we separated the components.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>And finally the output of <code>::response/&#8594;response</code> component (which will be a stream of ring responses) should
goes to <code>::web/server</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example we branched off our workflow from <code>::web/server</code> based on couple of predicates functions. Each branch
will do its job and will have its own workflow. Finally we merge both pipes back in <code>::web/server</code> again. So any
request flowing from webserver that is not a request to get the root path will goes to <code>::crawler/job</code> and the content
would be fetched from the actual host and the request for root path will goes to <code>::loader/job</code> and loads from a file
on filesystem. Pretty neat, right?</p>
</div>
<div class="paragraph">
<p>I hope this tutorial gave you an idea about HellHound systems. HellHound is definitely more than this, but now you have
enough knowledge to get started with <strong>HellHound</strong>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="systems"><a class="anchor" href="#systems"></a>3. Systems</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At heart, <strong>HellHound</strong> created around the idea of systems. The basic idea is to describe the execution model and
dataflow of a program using data and let <strong>HellHound</strong> handles the rest. Systems are the first concept of <strong>HellHound</strong>
which you need to learn about.</p>
</div>
<div class="sect2">
<h3 id="_overview"><a class="anchor" href="#_overview"></a>3.1. Overview</h3>
<div class="paragraph">
<p>Let&#8217;s take a quick conceptual look at <strong>HellHound Systems</strong>. As you already know <strong>HellHound System</strong> is available under <code>codamic/hellhound.core</code> and <code>codamic/hellhound</code> artifacts.</p>
</div>
<div class="sect3">
<h4 id="_the_unix_philosophy"><a class="anchor" href="#_the_unix_philosophy"></a>3.1.1. The Unix Philosophy</h4>
<div class="paragraph">
<p>Contemporary software engineering still has a lot to learn from the 1970s. As we’re in such a fast-moving field, we often have a tendency of dismissing older ideas as irrelevant—and consequently, we end up having to learn the same lessons over and over again, the hard way. Although computers have become faster, data has grown bigger, and requirements have become more complex, many old ideas are actually still highly relevant today.</p>
</div>
<div class="paragraph">
<p>In this section, I’d like to highlight one particular set of old ideas that I think deserves more attention today, the Unix philosophy.</p>
</div>
<div class="sect4">
<h5 id="_unix_pipeline"><a class="anchor" href="#_unix_pipeline"></a>Unix pipeline</h5>
<div class="paragraph">
<p>The Unix philosophy is a set of principles that emerged gradually during the design and implementation of Unix systems during the late 1960s and 1970s. There are various interpretations of the Unix philosophy, but in the 1978 description by Doug McIlroy, Elliot Pinson, and Berk Tague, two points particularly stand out:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make each program do one thing well. To do a new job, build afresh rather than complicate old programs by adding new “features.”</p>
</li>
<li>
<p>Expect the output of every program to become the input to another, as yet unknown, program.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These principles are the foundation for chaining together programs into pipelines that can accomplish complex processing tasks. The key idea here is that a program does not know or care where its input is coming from, or where its output is going: it may be a file, or another program that’s part of the operating system, or another program written by someone else entirely.</p>
</div>
</div>
<div class="sect4">
<h5 id="_pipes_and_composability"><a class="anchor" href="#_pipes_and_composability"></a>Pipes and Composability</h5>
<div class="paragraph">
<p>The tools that come with the operating system are generic, but they are designed such that they can be composed together into larger programs that can perform application-specific tasks.</p>
</div>
<div class="paragraph">
<p>The benefits that the designers of Unix derived from this design approach sound quite like the ideas of the Agile and DevOps movements that appeared decades later: scripting and automation, rapid prototyping, incremental iteration, being friendly to experimentation, and breaking down large projects into manageable chunks.</p>
</div>
<div class="paragraph">
<p>When you join two commands by using the pipe character in your shell, the shell starts both programs at the same time, and attaches the output of the first process to the input of the second process. This attachment mechanism uses the pipe syscall provided by the operating system.</p>
</div>
<div class="paragraph">
<p>Note that this wiring is not done by the programs themselves; it’s done by the shell—this allows the programs to be loosely coupled, and not worry about where their input is coming from or where their output is going.</p>
</div>
<div class="paragraph">
<p>The pipe had been invented in 1964 by Doug McIlroy, who described it like this in an internal Bell Labs memo, “We should have some ways of coupling programs like [a] garden hose—screw in another segment when it becomes necessary to massage data in another way.”</p>
</div>
<div class="paragraph">
<p>The Unix team also realized early that the interprocess communication mechanism (pipes) can look very similar to the I/O mechanism for reading and writing files. We now call this input redirection (using the contents of a file as input to a process) and output redirection.</p>
</div>
<div class="paragraph">
<p>The reason that Unix programs can be composed so flexibly is that they all conform to the same interface. Most programs have one stream for input data (<code>stdin</code>) and two output streams (<code>stdout</code> for regular output data, and stderr for errors and diagnostic messages to the user).</p>
</div>
<div class="paragraph">
<p>Programs can also do other things besides reading stdin and writing stdout, such as reading and writing files, communicating over the network, or drawing a graphical user interface. However, the stdin/stdout communication is considered to be the main means for data to flow from one Unix tool to another.</p>
</div>
<div class="paragraph">
<p>The great thing about the stdin/stdout interface is that anyone can implement it easily, in any programming language. You can develop your own tool that conforms to this interface, and it will play nicely with all the standard tools that ship as part of the operating system.</p>
</div>
</div>
<div class="sect4">
<h5 id="_composability_requires_a_uniform_interface"><a class="anchor" href="#_composability_requires_a_uniform_interface"></a>Composability Requires a Uniform Interface</h5>
<div class="paragraph">
<p>We said that Unix tools are composable because they all implement the same interface of <code>stdin</code>, <code>stdout</code>, and <code>stderr</code>, and each of these is a file descriptor; that is, a stream of bytes that you can read or write like a file. This interface is simple enough that anyone can easily implement it, but it is also powerful enough that you can use it for anything.</p>
</div>
<div class="paragraph">
<p>Because all Unix tools implement the same interface, we call it a uniform interface. That’s why you can pipe the output of <code>gunzip</code> to <code>wc</code> without a second thought, even though those two tools appear to have nothing in common. It’s like lego bricks, which all implement the same pattern of knobbly bits and grooves, allowing you to stack any lego brick on any other, regardless of their shape, size, or color.</p>
</div>
<div class="paragraph">
<p>A few tools (e.g., <code>gzip</code>) operate purely on byte streams and don’t care about the structure of the data. But most tools need to parse their input in order to do anything useful with it. For this, most Unix tools use ASCII, with each record on one line, and fields separated by tabs or spaces, or maybe commas.</p>
</div>
</div>
<div class="sect4">
<h5 id="_hellhound_unix_philosophy"><a class="anchor" href="#_hellhound_unix_philosophy"></a>HellHound &amp; Unix Philosophy</h5>
<div class="paragraph">
<p>We’ve seen that Unix has developed good design principles for software development. HellHound&#8217;s systems mostly follow the same design principle. There are several differences though. A Unix pipe is designed to have a single sender process and a single recipient. You can’t use pipes to send output to several processes, or to collect input from several processes. But HellHound Systems are not like this. A Component (process) can pipe its output to more than one component and accept its input from more than one component.</p>
</div>
<div class="paragraph">
<p>Instead of reading/writing data in text, components communicate via stream abstractions delivering data structures like hashmaps.</p>
</div>
<div class="paragraph">
<p>Unix processes are generally assumed to be fairly short-running. For example, if a process in the middle of a pipeline crashes, there is no way for it to resume processing from its input pipe—the entire pipeline fails and must be re-run from scratch. That’s no problem if the commands run only for a few seconds, but if an application is expected to run continuously for years, you need better fault tolerance. Systems in the other hand design for long-running tasks. A component assumes to run for a long time and constantly consume from its input and product to its output stream. But still if a component fails it&#8217;s possible to restart the component and re-pipe it, so it can continue where it left off. But right now there is no support for restarting a component. We plan to add the support for version 1.1.0 (hopefully).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_execution_model"><a class="anchor" href="#_execution_model"></a>3.1.2. Execution model</h4>
<div class="paragraph">
<p>Systems composed by [Components]. A system knows how to start and stop components. It is also
responsible for managing dependencies between theme. Components are the smallest parts of a system whic are reusable.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/system.svg" alt="A very basic schema of a System">
</div>
<div class="title">Figure 1. A very basic schema of a System</div>
</div>
<div class="paragraph">
<p>A <strong>HellHound</strong> system is basically a <code>map</code> describing different aspects of a program. Each program might have several
systems. For example a development system and a production system. But there would be just a system running at a given
time.</p>
</div>
<div class="paragraph">
<p>Systems should follow a certain spec (<code>:hellhound.system/system</code>). For example any system should have a`:components` key
with a vector as its value. All the <code>components</code>of the system should be defined under this key. Each component is a <code>map</code>
describing the behaviours of that component (For more info on components read [here](./Components.md)).</p>
</div>
<div class="paragraph">
<p>In order to use <strong>HellHound</strong> systems. First you need to define your system by defining a map with at least one key. Yupe,
you guessed it correctly, the <code>:components</code> key. We&#8217;re going to discuss the system&#8217;s keys in bit. So for now just let&#8217;s
talk about how to start and stop a system.</p>
</div>
<div class="paragraph">
<p>After defining the system. The next step would be to set the defined system as the default system of your program by using
<code>hellhound.system/set-system!</code> function. This function accepts just one argument which is the system map. It basically
analayze the given map and set it as the default system of the program. From now on, you can call <code>hellhound.system/start</code>
and <code>hellhound.system/stop</code> function.</p>
</div>
<div class="paragraph">
<p>Basic execution flows of a system are <code>start</code> and <code>stop</code>. Both of them creates a graph from the system components and their
dependencies. Then they <code>start</code>/<code>stop</code> the system by walking through that graph and calling the <code>start-fn</code> and <code>stop-fn</code>
function of each component.</p>
</div>
<div class="paragraph">
<p>After starting a system, you can access the running system via <code>hellhound.system/system</code> function. It would returns a map
describing the current running system including all the running components.</p>
</div>
<div class="paragraph">
<p>There are two ways to manage dependencies in your components code. The first one via a the system map itself, by treating
the system map as a repository of dependencies. The second way is via dependency injection model which is not supported
at this version (<code>v1.0.0</code>). Anyway, any component can pull what ever it needs from the system map by calling
<code>hellhound.system/get-component</code> function and passing the component name to it. This function will simply look for the
component in system map and returns the running component map. There is a huge problem with this apparoach. By using this
apparoach components knows too much about the environment around them, so it reduce their portablity.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In near future we&#8217;re going to add the support for dependency injection to <strong>HellHound</strong> systems.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/system-deps.svg" alt="A schema of components of a system and how they might depends on each other">
</div>
<div class="title">Figure 2. A schema of components of a system and how they might depends on each other</div>
</div>
</div>
<div class="sect3">
<h4 id="_workflow"><a class="anchor" href="#_workflow"></a>3.1.3. Workflow</h4>
<div class="paragraph">
<p>System&#8217;s workflow describes the dataflow of the system. It describes where data comes in and where information goes out of
the system. By "where" I mean which component of the system. As mentioned before each <strong>HellHound</strong> [Component](./Components.md)
has an <strong>input stream</strong> and an <strong>output stream</strong> assigned to them. You can think of each component as a pipe, the whole
system as a pipeline. Data flows to this pipeline based on your piping (description) from entry points and exits the pipeline
from exit points. Pipeline might have more than one entry or exit points or none at all.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/component-io.svg" alt="Components process the input stream and produce the output put stream">
</div>
<div class="title">Figure 3. Components process the input stream and produce the output put stream</div>
</div>
<div class="paragraph">
<p>Using the system workflow you can design an open or a close dataflow for your system. A Close system is a type of system
which all of its components have their <strong>input</strong> and <strong>output</strong> connected. In the other hand, an open system is a type of
system which <strong>NOT</strong> all of the <strong>inputs</strong> and <strong>outputs</strong> of components connected to each other.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="./images/workflow-types.svg" alt="Open system on the left and Close system on the right">
</div>
<div class="title">Figure 4. Open system on the left and Close system on the right</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Don&#8217;t confuse Input and Output of each component which components dependencies.</div>

</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Components of a system should consum from their <code>INPUT</code> and produce their <code>OUTPUT</code> in non-blocking fashion in order to avoid
blocking in a system.</p>
</div>
<div class="paragraph">
<p>Check out the [workflow](./Workflow.md) section for more information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="components"><a class="anchor" href="#components"></a>3.2. Components</h3>
<div class="paragraph">
<p>A <strong>Component</strong> is a data structure to managing the lifecycle, dependencies
and data flow of a program. A Component is the smallest unit of execution which is reusable and
easy to reason about.</p>
</div>
<div class="paragraph">
<p>A component is similar in spirit to the definition of an object in Object-Oriented Programming.
This does not alter the primacy of pure functions and immutable data structures in Clojure as
a language. Most functions are just functions, and most data are just data. Components are intended
to help manage stateful resources within a functional paradigm.</p>
</div>
<div class="sect3">
<h4 id="_advantages_of_the_component_model"><a class="anchor" href="#_advantages_of_the_component_model"></a>3.2.1. Advantages of the Component Model</h4>
<div class="paragraph">
<p>Large applications often consist of many stateful processes which must be started and stopped in
a particular order. The component model makes those relationships explicit and declarative, instead
of implicit in imperative code.</p>
</div>
<div class="paragraph">
<p>Components provide some basic guidance for structuring a <strong>HellHound</strong> application, with boundaries
between different parts of a system. Components offer some encapsulation, in the sense of grouping
together related entities. Each component receives references only to the things it needs, avoiding
the unnecessary shared state. Instead of reaching through multiple levels of nested maps, a component
can have everything it needs at most one map lookup away.</p>
</div>
<div class="paragraph">
<p>Instead of having mutable state (atoms, refs, etc.) scattered throughout different namespaces, all
the stateful parts of an application can be gathered together. In some cases, using components may
eliminate the need for mutable references altogether, for example, to store the "current" connection
to a resource such as a database. At the same time, having all state reachable via a single
[<strong>system</strong>](./README.md#overview) map makes it easy to reach in and inspect any part of the application
from the REPL.</p>
</div>
<div class="paragraph">
<p>The component dependency model makes it easy to swap in <strong>stub</strong> or <strong>mock</strong> implementations of a component
for testing purposes, without relying on time-dependent constructs, such as with-redefs or binding, which are
often subject to race conditions in multi-threaded code.</p>
</div>
<div class="paragraph">
<p>Having a coherent way to set up and tear down all the state associated with an application enables rapid
development cycles without restarting the JVM. It can also make unit tests faster and more independent,
since the cost of creating and starting a system is low enough that every test can create a new instance
of the system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_disadvantages_of_the_component_model"><a class="anchor" href="#_disadvantages_of_the_component_model"></a>3.2.2. Disadvantages of the Component Model</h4>
<div class="paragraph">
<p>For small applications, declaring the dependency relationships among components may actually be more work than
manually starting all the components in the correct order or even not using component model at all. Everything
comes at a price.</p>
</div>
<div class="paragraph">
<p>The [<strong>system</strong>](./README.md#overview) map produced by <strong>HellHound</strong> is a complex map and it is typically too
large to inspect visually. But there are enough helper functions in <code>hellhound.system`</code> namespace to help
you with it.</p>
</div>
<div class="paragraph">
<p>You must explicitly specify all the dependency relationships among components: the code cannot discover these
relationships automatically.</p>
</div>
<div class="paragraph">
<p>Finally, <strong>HellHound</strong> system forbids cyclic dependencies among components. I believe that cyclic dependencies
usually indicate architectural flaws and can be eliminated by restructuring the application. In the rare case
where a cyclic dependency cannot be avoided, you can use mutable references to manage it, but this is outside
the scope of components.</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage"><a class="anchor" href="#_usage"></a>3.2.3. Usage</h4>
<div class="paragraph">
<p>Components are the main parts of HellHound systems. Basically, each component is an implementation of <code>IComponent</code>
protocol. The protocol which defines a component functionality. By default HellHound implements <code>IComponent</code>
protocols for hashmaps only. So we can define components in form of maps.</p>
</div>
<div class="paragraph">
<p>In order to define a component, a map should contain the following keys (All the keys should be namespaced
keyword under <code>hellhound.component</code>):</p>
</div>
<div id="_component_name" class="ulist">
<ul>
<li>
<p><code><strong>name</strong></code>: The name of the component. It should be a namespaced keyword.
This key is <strong>mandatory</strong>.</p>
</li>
</ul>
</div>
<div id="_component_depends_on" class="ulist">
<ul>
<li>
<p><code><strong>depends-on</strong></code>: This key specifies all the components which are the
dependencies of the current component. A collection  of components
name.
This key is optional.</p>
</li>
</ul>
</div>
<div id="_component_start_fn" class="ulist">
<ul>
<li>
<p><code><strong>start-fn</strong></code>: A function which takes which takes two arguments. The component map
and a <a href="#_context_map">context map</a>. Returns the component with the necessary keys
attached to it. This function is responsible for <strong>starting</strong> the component.
Practically your component code goes into this function.
This key is <strong>mandatory</strong>.</p>
</li>
</ul>
</div>
<div id="_component_stop_fn" class="ulist">
<ul>
<li>
<p><code><strong>stop-fn</strong></code>: A function which takes the component map as the only argument
and return the component with the necessary keys attached to it. This
function is responsible for <strong>stoping</strong> the component.
This key is <strong>mandatory</strong>.</p>
</li>
</ul>
</div>
<div id="_component_input_stream_fn" class="ulist">
<ul>
<li>
<p><code><strong>input-stream-fn</strong></code>: A function which returns a <code>manifold</code> as the input
of the component. You rarely need to use this key for a component.
This key optional.</p>
</li>
</ul>
</div>
<div id="_component_output_stream_fn" class="ulist">
<ul>
<li>
<p><code><strong>output-stream-fn</strong></code>: A function which returns a <code>manifold</code> as the output
of the component. You rarely need to use this key for a component.
This key optional.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So as an example:</p>
</div>
<div class="listingblock">
<div class="title">A Stupid component which does nothing</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre>(<span class="keyword">def</span> <span class="function">sample-component</span>
  {<span class="symbol">:hellhound.component/name</span> <span class="symbol">:sample.core/component-A</span> <i class="conum" data-value="1"></i><b>(1)</b>
   <span class="symbol">:hellhound.component/start-fn</span> (<span class="keyword">fn</span> [component] component) <i class="conum" data-value="2"></i><b>(2)</b>
   <span class="symbol">:hellhound.component/stop-fn</span> (<span class="keyword">fn</span> [component] component)  <i class="conum" data-value="3"></i><b>(3)</b>
   <span class="symbol">:hellhound.component/depends-on</span> [<span class="symbol">:sample.core/component-B</span>]}) <i class="conum" data-value="4"></i><b>(4)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Description of the component name which is <code>:sample.code/component-A</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The function which is responsible for starting the component. Which does nothing in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The function which is responsible for stapping the component. Which does nothing in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Description of the dependencies of <code>:sample.code/component-A</code>. In this case this component
depends on another component called <code>:sample.core/component-B</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see creating a component is fairly simple and nothing special.</p>
</div>
</div>
<div class="sect3">
<h4 id="_context_map"><a class="anchor" href="#_context_map"></a>3.2.4. Context Map</h4>
<div class="paragraph">
<p>As you already know, <a href="#_component_start_fn">start-fn</a> of a component takes two arguments.
The first one it the component map itself and second one is a hashmap called <strong>context map</strong>.</p>
</div>
<div class="paragraph">
<p>The purpose of a context map is to provides co-effects for the component, Such as dependency
components. For example <strong>HellHound</strong> inject a key called <code>:dependencies</code> to the context map which
is a vector containing those components that this component is depends on. The order of this
vector would be exactly the same as <a href="#_component_depends_on">:depends-on</a> value in component
description map. So you can get all you need from the context map. You can think of it as some
sort of dependency injection for you component.</p>
</div>
<div class="paragraph">
<p>But context map contains more data that you might need them in action. Here is the list of keys
of a context map:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>:dependencies</code></strong>: A vector of running components which the current component is depends on.
All the components in this vector already started and the order is the same as the vector
provided to <a href="#_component_depends_on">:depends-on</a> in component map.</p>
</li>
<li>
<p><strong><code>:dependencies-map</code></strong>: A hashmap containing all the components of the current component dependencies.
keys of this map are the components names and the values are the running components. The purpose
of this map is to access dependency components by name.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="workflow"><a class="anchor" href="#workflow"></a>3.3. Workflow</h3>
<div class="paragraph">
<p>System&#8217;s workflow a vector describing the dataflow of the system. Each component has an input and an output stream. Each
stream is a`manifold.stream`. HellHound connects io of each component to another component based on the desciption given
by the <code>:workflow</code> of the system.</p>
</div>
<div class="paragraph">
<p>System&#8217;s workflow is a vector of vectors. Each vector contains two mandatory element which are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The name of the output component</p>
</li>
<li>
<p>The name of the input component</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, consider the following system:</p>
</div>
<div class="listingblock">
<div class="title">Snippet 1 - A HellHound system</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td>
  <td class="code"><pre>(<span class="keyword">ns</span> <span class="namespace">example.system</span>
  <span class="comment">;; We want to use defcomponenet to define the components instead of defining the maps</span>
  (<span class="symbol">:require</span> [hellhound.system <span class="symbol">:as</span> hh]
            [hellhound.system <span class="symbol">:as</span> hcomp]
            [manifold.stream <span class="symbol">:as</span> s]))

(<span class="keyword">defn</span> <span class="function">dummy-start</span> <i class="conum" data-value="1"></i><b>(1)</b>
  [component ctx]
  (<span class="keyword">let</span> [input  (hcomp/input  component)
        output (hcomp/output component)])
  <span class="comment">;; Simply direct incoming data to output</span>
  (s/connect input output)
  component)

(<span class="keyword">defn</span> <span class="function">dummy-stop</span> [component] component)

(<span class="keyword">def</span> <span class="function">example-system</span>
     {<span class="symbol">:components</span> [(hcomp/make-component <span class="symbol">:component-1</span> dummy-start dummy-stop)   <i class="conum" data-value="2"></i><b>(2)</b>
                   (hcomp/make-component <span class="symbol">:component-2</span> dummy-start dummy-stop)   <i class="conum" data-value="3"></i><b>(3)</b>
                   (hcomp/make-component <span class="symbol">:component-3</span> dummy-start dummy-stop)]  <i class="conum" data-value="4"></i><b>(4)</b>

      <span class="symbol">:workflow</span> [[<span class="symbol">:component-1</span> <span class="symbol">:component-2</span>]    <i class="conum" data-value="5"></i><b>(5)</b>
                 [<span class="symbol">:component-2</span> <span class="symbol">:component-3</span>]]}) <i class="conum" data-value="6"></i><b>(6)</b>


(hh/set-system! example-system) <i class="conum" data-value="7"></i><b>(7)</b>
(hh/start!) <i class="conum" data-value="8"></i><b>(8)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A dummy start function which connects input to output directly</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Definition of <code>component-1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Definition of <code>component-2</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Definition of <code>component-2</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Description to connect output of <code>component-1</code> to input <code>component-2</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Description to connect output of <code>component-2</code> to input <code>component-3</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Sets <code>example-system</code> as the current system</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Starts the current system.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the above snippet we defined three different components. For the sake of simplicity I skipped the start and
stop function defination of each component.</p>
</div>
<div class="paragraph">
<p>After starting the system defined in the above snippet, <strong>HellHound</strong> wires the input/output of each component
as we described in the system. So the running system workflow would be like:</p>
</div>
<div class="listingblock">
<div class="title">[Workflow 1]</div>
<div class="content">
<pre> Data --&gt; Component 1 ---&gt; Component 2 ---&gt; Component 3 ---&gt; ...</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see in the above flow, the output of <code>component-3</code> goes to no where. It&#8217;s not necessary for a component to has
both input and output connected to somewhere. Some components are responsible for side effects. For example writing to DB,
Send data to client or dispatch an event to a kafka topic. These kind of components may not have an output stream. An other
example would be those components which provide data to the pipeline by reading from a DB or from an external stream like a
kafka stream of client side event stream and so on. These components do not need an input stream to operate.</p>
</div>
<div class="paragraph">
<p>So in the <code>example-system</code> we can test the workflow simply like this:</p>
</div>
<div class="listingblock">
<div class="title">Snippet 2 - An example of a working workflow</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>(<span class="keyword">let</span> [input1 (hcomp/input (hh/get-component <span class="symbol">:component-1</span>))
      output3 (hcomp/output (hh/get-component <span class="symbol">:component-3</span>))]
  (s/put! input1 <span class="integer">42</span>) <i class="conum" data-value="1"></i><b>(1)</b>
  (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">output: </span><span class="delimiter">&quot;</span></span> @(s/take! output3))) <span class="comment">;; ==&gt; output: 42  </span><i class="conum" data-value="2"></i><b>(2)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Put number <code>42</code> into the pipeline enterance point</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Take the output from the output point of the pipeline</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since we we connected our pipeline as described in <strong>workflow 1</strong>, The value which we put into input stream of <code>component-1</code>,
retreived from the output stream of <code>component-3</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Don&#8217;t forget that our components simply connect their input stream to their output stream
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now let&#8217;s change our workflow to create a tree like pipeline. Now let&#8217;s change the <code>:workflow</code> of <code>example-system</code> as follow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"> <span class="symbol">:workflow</span> [[<span class="symbol">:component-1</span> <span class="symbol">:component-2</span>]
            [<span class="symbol">:component-1</span> <span class="symbol">:component-3</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now with this new workflow, our dataflow would be like:</p>
</div>
<div class="listingblock">
<div class="title">[Workflow 2]</div>
<div class="content">
<pre>                         |---&gt; Component 2 ---&gt; ...
Data --&gt; Component 1 --&gt; |
                         |---&gt; Component 3 ---&gt; ...</pre>
</div>
</div>
<div class="paragraph">
<p>So both of <code>component-2</code> and <code>component-3</code> would get their input from <code>component-1</code>. Any input comes to <code>component-1</code> would be available
separately in the output of <code>component-2</code> and <code>component-3</code> and taking that value from the output of <code>component-2</code> would not affect the
output of <code>component-3</code>.</p>
</div>
<div class="sect3">
<h4 id="_conditional_workflow"><a class="anchor" href="#_conditional_workflow"></a>3.3.1. Conditional Workflow</h4>
<div class="paragraph">
<p>Sometimes, we need to dispatch values to a component conditionally. For example imagin a system that is responsible for separeting odd numbers
from even numbers in a stream of numbers. Checkout the following <code>workflow</code> definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre>  <span class="symbol">:workflow</span> [[<span class="symbol">:component-1</span> <span class="keyword">odd?</span>  <span class="symbol">:component-2</span>]
             [<span class="symbol">:component-1</span> <span class="keyword">even?</span> <span class="symbol">:component-3</span>]]</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see in the workflow definition above, it&#8217;s possible to describe a condition for dispatching values from a component to
another one. In the previous example all the values from <code>:component-1</code> flow to <code>:component-2</code> only if the provided condition
returns true for each incoming value which in this case only <code>odd</code> values are going to deliver to <code>component-2</code>. The same applies to
the second pipe but only <code>even</code> values flow to <code>component-3</code>.</p>
</div>
<div class="paragraph">
<p>The predicate function can be any function which receives an argument ( The value from upstream component ) and returns a boolean value
indicating whether the value should flow to the downstream component or not.</p>
</div>
<div class="paragraph">
<p>Base on what we discussed up until now we can test our workflow like this:</p>
</div>
<div class="listingblock">
<div class="title">Snippet 3 - Testing conditional workflow</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td>
  <td class="code"><pre><span class="comment">;; I skipped the ns declaration. It would be exactly like Snippet 1 in this section</span>
(<span class="keyword">let</span> [input1 (hcomp/input (hh/get-component <span class="symbol">:component-1</span>))
      output2 (hcomp/output2 (hh/get-component <span class="symbol">:component-2</span>))
      output3 (hcomp/output2 (hh/get-component <span class="symbol">:component-3</span>))]

  (s/consume #(<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Odd: </span><span class="delimiter">&quot;</span></span> %) output2) <i class="conum" data-value="1"></i><b>(1)</b>
  (s/consume #(<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Even: </span><span class="delimiter">&quot;</span></span> %) output3) <i class="conum" data-value="2"></i><b>(2)</b>

  (<span class="keyword">-&gt;</span> [<span class="integer">1</span> <span class="integer">2</span> <span class="integer">3</span> <span class="integer">4</span> <span class="integer">5</span>]
      (s/-&gt;source) <i class="conum" data-value="3"></i><b>(3)</b>
      (s/connect input1))) <i class="conum" data-value="4"></i><b>(4)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Adds a consumer function for the output stream of <code>:component-2</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Adds a consumer function for the output stream of <code>:component-3</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Converts the <code>[1 2 3 4 5]</code> vector to a stream source</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Connects the source stream resulted in step &lt;3&gt; to input of <code>:component-1</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The output of the above snippet would be like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Odd: 1
Even: 2
Odd: 3
Even: 4
Odd: 5</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Predicate functions should be pure</div>
<div class="paragraph">
<p>Predicate functions in each pipe should be pure and free of side effects. These functions should
be as fast as possible because <strong>HellHound</strong> calls them rapidly for each value in the pipe.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>&lt;PLACEHOLDER TEXT&gt; Explaination about predicate best practices and <code>hellhound.messaging</code> ns</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples"><a class="anchor" href="#_examples"></a>3.4. Examples</h3>
<div class="paragraph">
<p>Now, let&#8217;s take a look at some examples about how systems works and let&#8217;s take what we learned up until now
into an action. All the examples are available at the <a href="https://github.com/Codamic/hellhound_examples">hellhound_examples</a>
repository on github.</p>
</div>
<div class="sect3">
<h4 id="_very_simple_system"><a class="anchor" href="#_very_simple_system"></a>3.4.1. Very Simple System</h4>
<div class="paragraph">
<p>First of all let&#8217;s create a very simple component with just one dependency to have
a minimum working environment.</p>
</div>
<div class="paragraph">
<p>In order to execute the following example from the <a href="https://github.com/Codamic/hellhound_examples">hellhound_examples</a>
repository. Just issue the following command in the repository root directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ lein run -m systems.simple-system1/main</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ok let&#8217;s jump into the code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td>
  <td class="code"><pre>(<span class="keyword">ns</span> <span class="namespace">systems.simple-system1</span>
  (<span class="symbol">:require</span> [hellhound.system <span class="symbol">:as</span> system]
            [hellhound.component <span class="symbol">:as</span> hcomp]))

(<span class="keyword">defn</span> <span class="function">start-fn1</span> <i class="conum" data-value="1"></i><b>(1)</b>
  [component context]
  (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Starting Component 1...</span><span class="delimiter">&quot;</span></span>)
  (<span class="keyword">assoc</span> component <span class="symbol">:something-in</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>)) <i class="conum" data-value="2"></i><b>(2)</b>

(<span class="keyword">defn</span> <span class="function">stop-fn1</span> <i class="conum" data-value="3"></i><b>(3)</b>
  [component]
  (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Stopping component 2...</span><span class="delimiter">&quot;</span></span>)
  component)

(<span class="keyword">defn</span> <span class="function">start-fn2</span> <i class="conum" data-value="4"></i><b>(4)</b>
  [component context]
  (<span class="keyword">let</span> [component1 (<span class="keyword">first</span> (<span class="symbol">:dependencies</span> context)) <i class="conum" data-value="5"></i><b>(5)</b>
        component1-with-name (<span class="symbol">:simple-system/component-1</span> (<span class="symbol">:dependencies-map</span> context))] <i class="conum" data-value="6"></i><b>(6)</b>
    (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Starting Component 2...</span><span class="delimiter">&quot;</span></span>)
    (<span class="keyword">println</span> (<span class="symbol">:something-in</span> component1)) <i class="conum" data-value="7"></i><b>(7)</b>
    (<span class="keyword">println</span> (<span class="symbol">:something-in</span> component1-with-name))
    component))

(<span class="keyword">defn</span> <span class="function">stop-fn2</span>
  [component]
  (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Stopping component 2...</span><span class="delimiter">&quot;</span></span>)
  component)

(<span class="keyword">def</span> <span class="function">component-1</span> {<span class="symbol">:hellhound.component/name</span> <span class="symbol">:simple-system/component-1</span> <i class="conum" data-value="8"></i><b>(8)</b>
                  <span class="symbol">:hellhound.component/start-fn</span> start-fn1
                  <span class="symbol">:hellhound.component/stop-fn</span>  stop-fn1})

(<span class="keyword">def</span> <span class="function">component-2</span> (hcomp/make-component <span class="symbol">:simple-system/component-2</span>
                               start-fn2
                               stop-fn2
                               [<span class="symbol">:simple-system/component-1</span>])) <i class="conum" data-value="9"></i><b>(9)</b>

(<span class="keyword">def</span> <span class="function">simple-system</span> <i class="conum" data-value="10"></i><b>(10)</b>
  {<span class="symbol">:components</span> [component-2 component-1]})

(<span class="keyword">defn</span> <span class="function">main</span>
  []
  (system/set-system! simple-system) <i class="conum" data-value="11"></i><b>(11)</b>
  (system/start!)) <i class="conum" data-value="12"></i><b>(12)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The start function of the component 1 which will assign
to the component later in the component map.
The first argument is the componet map itself and the argument
is the context map which contains extra info about the context
which this component is running on.
As you already know start function of a component should return
a component map.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Assinged a simple value to a key in component map. So the running
component would have this value attached to it and other components
can use the value by getting it from the component map.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Stop function of the <code>component1</code>. It should returns a component map.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Start function of <code>component-2</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Gets the first dependency component. In the order which defined in the
component map <code>:depends-on</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Gets the same component by it&#8217;s name instead.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Gets a value from another component.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>A component map which defines the <code>:simple-system/component-1</code> component
Intentionally we defined this component by defining a map directly.
But you can use <code>make-component</code> function as a shortcut.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>We used <code>make-component</code> to define a component called <code>:simple-system/component-2</code>.
It basically returns a map like we had in component-1 with the given details.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>A very simple <code>system</code> defination which does not have any workflow.
Please not that the order of components in <code>:components</code> vector is
<strong>NOT</strong> important at all.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Setting the <code>simple-system</code> as the default system of the application.</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Start the default system.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The last argument is the dependency vector of the component that exactly is
going to be the <code>:depends-on</code> key in the component map.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When we execute the above code the output would be something like:</p>
</div>
<div class="listingblock">
<div class="title">The output of the above namespace</div>
<div class="content">
<pre class="CodeRay highlight"><code>[17-10-29 12:27:37] [DEBUG] &lt;hellhound.component:115&gt; - Starting component ':simple-system/component-1'... <i class="conum" data-value="1"></i><b>(1)</b>
Starting Component 1... <i class="conum" data-value="2"></i><b>(2)</b>
[17-10-29 12:27:37] [DEBUG] &lt;hellhound.component:115&gt; - Starting component ':simple-system/component-2'...
Starting Component 2... <i class="conum" data-value="3"></i><b>(3)</b>
Hello World <i class="conum" data-value="4"></i><b>(4)</b>
Hello World <i class="conum" data-value="5"></i><b>(5)</b>
[17-10-29 12:27:37] [DEBUG] &lt;hellhound.component:120&gt; - Component ':simple-system/component-1' already started. Skipping... <i class="conum" data-value="6"></i><b>(6)</b>
[17-10-29 12:27:37] [INFO] &lt;hellhound.system.core:142&gt; - System started successfully. <i class="conum" data-value="7"></i><b>(7)</b>
[17-10-29 12:27:37] [DEBUG] &lt;hellhound.system.workflow:104&gt; - Setting up workflow...
[17-10-29 12:27:37] [INFO] &lt;hellhound.system.workflow:107&gt; - Workflow setup done.</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A log entry with <code>DEBUG</code> level states that HellHound is going to start <code>:simple-system/component-1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The output of the <code>println</code> in line of [6] of the above code.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The output of the <code>println</code> in line of [18] of the above code.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The output of the <code>println</code> function in the start function of th <code>:simple-system/component-2</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Same as number 4.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>A log entry which states that <code>:simple-system/component-1</code> is already running and HellHound is going to skipp it.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>System started at this point completely.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_simple_workflow"><a class="anchor" href="#_simple_workflow"></a>3.4.2. Simple workflow</h4>
<div class="paragraph">
<p>In this example we&#8217;re going to create a really simple system with a simple
linear workflow. The workflow is really simple, data will flow from <code>component-1</code>
to <code>component-2</code> and then <code>component-3</code>. Each component transoform the value and put
it to the output.</p>
</div>
<div class="paragraph">
<p>In order to execute the following example from the <a href="https://github.com/Codamic/hellhound_examples">hellhound_examples</a>
repository. Just issue the following command in the repository root directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ lein run -m systems.simple-system2/main</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ok let&#8217;s jump into the code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre></td>
  <td class="code"><pre>(<span class="keyword">ns</span> <span class="namespace">systems.simple-system2</span>
  (<span class="symbol">:require</span>
   [manifold.stream <span class="symbol">:as</span> s]
   [hellhound.system <span class="symbol">:as</span> system]
   [hellhound.component <span class="symbol">:as</span> hcomp]))

(<span class="keyword">defn</span> <span class="function">start-fn1</span> <i class="conum" data-value="1"></i><b>(1)</b>
  [component context]
  (<span class="keyword">let</span> [input  (hcomp/input component)
        output (hcomp/output component)]

    (s/consume (<span class="keyword">fn</span> [x]
                 (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Message Component 1: </span><span class="delimiter">&quot;</span></span> x)
                 (s/put! output (<span class="keyword">inc</span> x)))
               input))
  component)

<span class="comment">;; Stop function of all the components. It should returns a component</span>
<span class="comment">;; map.</span>
(<span class="keyword">defn</span> <span class="function">stop-fn</span>
  [component]
  component)

<span class="comment">;; Start function of component-2.</span>
(<span class="keyword">defn</span> <span class="function">start-fn2</span>
  [component context]
  (<span class="keyword">let</span> [input (hcomp/input component) <i class="conum" data-value="2"></i><b>(2)</b>
        output (hcomp/output component)] <i class="conum" data-value="3"></i><b>(3)</b>

    (s/connect-via input
                   (<span class="keyword">fn</span> [x]
                     (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Message Component 2: </span><span class="delimiter">&quot;</span></span> x)
                     (s/put! output (<span class="keyword">inc</span> x)))
                   output) <i class="conum" data-value="4"></i><b>(4)</b>
    component))

<span class="comment">;; Start function of component-2.</span>
(<span class="keyword">defn</span> <span class="function">start-fn3</span>
  [component context]
  (<span class="keyword">let</span> [input (hcomp/input component)]
    (s/consume #(<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Message Component 3: </span><span class="delimiter">&quot;</span></span> %) input) <i class="conum" data-value="5"></i><b>(5)</b>
    component))

(<span class="keyword">def</span> <span class="function">component-1</span> (hcomp/make-component <span class="symbol">:simple-system/component-1</span> start-fn1 stop-fn)) <i class="conum" data-value="6"></i><b>(6)</b>
(<span class="keyword">def</span> <span class="function">component-2</span> (hcomp/make-component <span class="symbol">:simple-system/component-2</span> start-fn2 stop-fn))
(<span class="keyword">def</span> <span class="function">component-3</span> (hcomp/make-component <span class="symbol">:simple-system/component-3</span> start-fn3 stop-fn))

(<span class="keyword">def</span> <span class="function">simple-system</span>
  {<span class="symbol">:components</span> [component-2 component-1 component-3]
   <span class="symbol">:workflow</span> [[<span class="symbol">:simple-system/component-1</span> <span class="symbol">:simple-system/component-2</span>] <i class="conum" data-value="7"></i><b>(7)</b>
              [<span class="symbol">:simple-system/component-2</span> <span class="symbol">:simple-system/component-3</span>]]})

(<span class="keyword">defn</span> <span class="function">main</span>
  []
  (system/set-system! simple-system)
  (system/start!)


  (<span class="keyword">let</span> [component1 (system/get-component <span class="symbol">:simple-system/component-1</span>) <i class="conum" data-value="8"></i><b>(8)</b>
        input      (hcomp/input component1)]

    (<span class="keyword">-&gt;</span> [<span class="integer">1</span> <span class="integer">2</span> <span class="integer">3</span> <span class="integer">4</span> <span class="integer">5</span> <span class="integer">6</span>]
        (s/-&gt;source) <i class="conum" data-value="9"></i><b>(9)</b>
        (s/connect input))) <i class="conum" data-value="10"></i><b>(10)</b>
  (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Done.</span><span class="delimiter">&quot;</span></span>))</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The start function of the component 1 which will assign
to the component later in the component map.
The first argument is the componet map itself and the argument
is the context map which contains extra info about the context
which this component is running on.
As you already know start function of a component should return
a component map.
This component basically applies function <code>inc</code> on any incoming
value from its input and put it to its output.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Gets the input of the current component</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Gets the output of the current component</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Connects input to output via an anonymous function which
applies <code>inc</code> function to incoming values and dispatches them
to the output</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Simply consumes any incoming value and applies a function to that value</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Defining all three components needed for this system to work. Please notice
that we didn&#8217;t defined any dependencies for these components. Pluging them
to each other using a workflow catalog is a different story from component
dependencies. We only need to define a component as a dependency if the second
component use the first one directly in its start or stop function.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Defines a system with a linear workflow. In this case <strong>HellHound</strong> starts all
the components in the system and then wires up components IO based on the
desciption given by the <code>:workflow</code> key of the system.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Gets a component with the name from the default system.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Converts the vector to a stream source</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Connects the stream source to the input of component1</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the system of this example, the workflow is like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>DATA ---&gt; component-1 ---&gt; component-2 ---&gt; component-3</pre>
</div>
</div>
<div class="paragraph">
<p>Component 3 don&#8217;t have any output stream. But it can have one.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When we execute the above code the output would be something like:</p>
</div>
<div class="listingblock">
<div class="title">The output of the above namespace</div>
<div class="content">
<pre class="CodeRay highlight"><code>[17-10-29 21:52:37] [DEBUG] &lt;hellhound.component:115&gt; - Starting component ':simple-system/component-2'...
[17-10-29 21:52:37] [DEBUG] &lt;hellhound.component:115&gt; - Starting component ':simple-system/component-1'...
[17-10-29 21:52:37] [DEBUG] &lt;hellhound.component:115&gt; - Starting component ':simple-system/component-3'...
[17-10-29 21:52:37] [INFO] &lt;hellhound.system.core:142&gt; - System started successfully.
[17-10-29 21:52:37] [DEBUG] &lt;hellhound.system.workflow:107&gt; - Setting up workflow...
[17-10-29 21:52:37] [INFO] &lt;hellhound.system.workflow:110&gt; - Workflow setup done.
Message Component 1:  1
Message Component 2:  2
Message Component 3:  3
Message Component 1:  2
Message Component 2:  3
Message Component 3:  4
Message Component 1:  3
Message Component 2:  4
Message Component 3:  5
Message Component 1:  4
Message Component 2:  5
Message Component 3:  6
Message Component 1:  5
Message Component 2:  6
Message Component 3:  7
Message Component 1:  6
Message Component 2:  7
Message Component 3:  8
Done.</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the output above data flows to the pipeline and each component transoforms
the value it gets from its input to a new value and put it into the output.</p>
</div>
<div class="paragraph">
<p>In the above example we used a simple vector and converted it to a <a href="#_stream">stream</a> source,
but in practice the data flows to our system from an external source like a web server.</p>
</div>
</div>
<div class="sect3">
<h4 id="_conditional_workflow_2"><a class="anchor" href="#_conditional_workflow_2"></a>3.4.3. Conditional Workflow</h4>
<div class="paragraph">
<p>This example is dedicated to conditional workflow. A quick demonstration of how you can
setup a conditional workflow in your system.</p>
</div>
<div class="paragraph">
<p>In order to execute the following example from the <a href="https://github.com/Codamic/hellhound_examples">hellhound_examples</a>
repository. Just issue the following command in the repository root directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ lein run -m systems.simple-system3/main</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ok let&#8217;s jump into the code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td>
  <td class="code"><pre>(<span class="keyword">ns</span> <span class="namespace">systems.simple-system3</span>
  (<span class="symbol">:require</span>
   [manifold.stream <span class="symbol">:as</span> s]
   [hellhound.system <span class="symbol">:as</span> system]
   [hellhound.component <span class="symbol">:as</span> hcomp]))

(<span class="keyword">defn</span> <span class="function">start-fn1</span>
  [component context]
  (<span class="keyword">let</span> [input  (hcomp/input component)
        output (hcomp/output component)]
    (s/connect input output)) <i class="conum" data-value="1"></i><b>(1)</b>
  component)

(<span class="keyword">defn</span> <span class="function">stop-fn</span>
  [component]
  component)

(<span class="keyword">defn</span> <span class="function">start-fn2</span>
  [component context]
  (<span class="keyword">let</span> [input (hcomp/input component)]
    (s/consume #(<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Odd: </span><span class="delimiter">&quot;</span></span> %) input) <i class="conum" data-value="2"></i><b>(2)</b>
    component))

<span class="comment">;; Start function of component-2.</span>
(<span class="keyword">defn</span> <span class="function">start-fn3</span>
  [component context]
  (<span class="keyword">let</span> [input (hcomp/input component)]
    (s/consume #(<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Even: </span><span class="delimiter">&quot;</span></span> %) input) <i class="conum" data-value="3"></i><b>(3)</b>
    component))

(<span class="keyword">def</span> <span class="function">component-1</span> (hcomp/make-component <span class="symbol">:simple-system/component-1</span> start-fn1 stop-fn))
(<span class="keyword">def</span> <span class="function">component-2</span> (hcomp/make-component <span class="symbol">:simple-system/component-2</span> start-fn2 stop-fn))
(<span class="keyword">def</span> <span class="function">component-3</span> (hcomp/make-component <span class="symbol">:simple-system/component-3</span> start-fn3 stop-fn))

(<span class="keyword">def</span> <span class="function">simple-system</span>
  {<span class="symbol">:components</span> [component-2 component-1 component-3]
   <span class="symbol">:workflow</span> [[<span class="symbol">:simple-system/component-1</span> <span class="keyword">odd?</span> <span class="symbol">:simple-system/component-2</span>] <i class="conum" data-value="4"></i><b>(4)</b>
              [<span class="symbol">:simple-system/component-1</span> <span class="keyword">even?</span> <span class="symbol">:simple-system/component-3</span>]]}) <i class="conum" data-value="5"></i><b>(5)</b>

(<span class="keyword">defn</span> <span class="function">main</span>
  []
  (system/set-system! simple-system)
  (system/start!)

  <span class="comment">;; Gets a component with the name from the default system.</span>
  (<span class="keyword">let</span> [component1 (system/get-component <span class="symbol">:simple-system/component-1</span>)
        input      (hcomp/input component1)]

    (<span class="keyword">-&gt;</span> [<span class="integer">1</span> <span class="integer">2</span> <span class="integer">3</span> <span class="integer">4</span> <span class="integer">5</span> <span class="integer">6</span>]
        (s/-&gt;source)
        (s/connect input)))
  (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Done.</span><span class="delimiter">&quot;</span></span>))</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Connects the input of the component to its output with no transformation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Consumes values from the input and print them out.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Consumes values from the input and print them out.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Connects the output of <code>:simple-system/component-1</code> to <code>:simple-system/component-2</code>,
But only delivers odd (hence the <code>odd?</code> predicate function) numbers to downstream
component.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Connects the output of <code>:simple-system/component-1</code> to <code>:simple-system/component-3</code>,
But only delivers even (hence the <code>even?</code> predicate function) numbers to downstream
component.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the system of this example, the workflow is like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>                 odd? | ---&gt; component-2
DATA ---&gt; component-1 |
                even? | ---&gt; component-3</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When we execute the above code the output would be something like:</p>
</div>
<div class="listingblock">
<div class="title">The output of the above namespace</div>
<div class="content">
<pre class="CodeRay highlight"><code>[17-10-29 22:39:48] [DEBUG] &lt;hellhound.component:115&gt; - Starting component ':simple-system/component-2'...
[17-10-29 22:39:48] [DEBUG] &lt;hellhound.component:115&gt; - Starting component ':simple-system/component-1'...
[17-10-29 22:39:48] [DEBUG] &lt;hellhound.component:115&gt; - Starting component ':simple-system/component-3'...
[17-10-29 22:39:48] [INFO] &lt;hellhound.system.core:142&gt; - System started successfully.
[17-10-29 22:39:48] [DEBUG] &lt;hellhound.system.workflow:107&gt; - Setting up workflow...
[17-10-29 22:39:48] [INFO] &lt;hellhound.system.workflow:110&gt; - Workflow setup done.
Odd:  1
Even:  2
Odd:  3
Even:  4
Odd:  5
Even:  6
Done.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above output is clear enough. Component 2 got only odd values and component 3 got the even values.
The predicate functions of a workflow catalog can be any function. But you need to bear in mind that
<strong>HellHound</strong> is going to run these predicates for each value so for the sake of performance we need to
keep the fast and pure.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_buil_in_components"><a class="anchor" href="#_buil_in_components"></a>4. Buil-in Components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>&lt;PLACEHOLDER TEXT&gt;</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_http"><a class="anchor" href="#_http"></a>5. HTTP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter is dedicated to those features of <strong>HellHound</strong> which are related to Web. We&#8217;ll learn all the necessary things to create a web application using <strong>HellHound</strong>.</p>
</div>
<div class="sect2">
<h3 id="_overview_2"><a class="anchor" href="#_overview_2"></a>5.1. Overview</h3>
<div class="paragraph">
<p>Let&#8217;s take tour around the HellHound&#8217;s HTTP to see how it works on top of the HellHound&#8217;s <a id="System"></a> .</p>
</div>
<div class="sect3">
<h4 id="_installation_2"><a class="anchor" href="#_installation_2"></a>5.1.1. Installation</h4>
<div class="paragraph">
<p>&lt;PLACEHOLDER TEXT&gt;</p>
</div>
</div>
<div class="sect3">
<h4 id="_building_blocks"><a class="anchor" href="#_building_blocks"></a>5.1.2. Building blocks</h4>
<div class="paragraph">
<p>The HTTP package of <strong>HellHound</strong> is made from several smaller parts which work together. Parts such as
HTTP router, Websocket server, Event Dispatcher and so on.</p>
</div>
<div class="paragraph">
<p>In general sense the HellHound&#8217;s HTTP stack  is just a barbone <a href="https://github.com/ring-clojure/ring">Ring</a>
compatible <a href="//pedestal.io">Pedestal</a> webserver. The recommended way of using it is through
<code>hellhound.components.webserver/factory</code> function with no parameter which creates a webserver with all
the default values which in most cases you don&#8217;t need to chaing. By default HellHound will spin up a
webserver which only serves assets, root enpoint and a websocket endpoint and the rest of the process
happens on the client side application (Which handles by HellHound again), So most of the time when
you need a new route in your application, you have to add it on the client side router. Ofcourse you
can choose to not follow the same pattern but then you won&#8217;t get enough benefit of using <strong>HellHound</strong>.</p>
</div>
<div class="paragraph">
<p>HTTP package of <strong>HellHound</strong> has been composed by several pieces. In its heart it uses the
<a href="http://pedestal.io/reference/interceptors">Pedestal&#8217;s Interceptors</a> to reply to HTTP requests.
So almost all of the Pedestal concepts applies to <strong>HellHound</strong> HTTP as well.</p>
</div>
<div class="paragraph">
<p>Another key part of HellHound HTTP package is the HTTP router. There are plenty or Clojure routers around but in my
opinion the best of is the Pdestal Router. It&#8217;s a data driven HTTP router with is simple, and predictable.
We&#8217;ll discuss Pedestal router later in this chapter.</p>
</div>
<div class="paragraph">
<p>The most important part of HTTP package is the webserver component which lives in <code>hellhound.components.webserver</code>.
Under the hood it uses <a href="http://aleph.io">Aleph</a> that is an asynchronous network library on top Netty.</p>
</div>
</div>
<div class="sect3">
<h4 id="_recommended_solution"><a class="anchor" href="#_recommended_solution"></a>5.1.3. Recommended solution</h4>
<div class="paragraph">
<p>&lt;PLACEHOLDER TEXT&gt;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_http_router"><a class="anchor" href="#_http_router"></a>5.2. HTTP Router</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you&#8217;re using the default configuration of HellHound HTTP package (<code>hellhound.components.webserver/default-factory</code>).
then you don&#8217;t need to learn about the router and can safely skip this section.,</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section contains Pedestal&#8217;s router reference which modified a little bit based on <strong>HellHound</strong> requirements.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>HellHound uses <code>Pedestal Router</code> for HTTP routing, So everything you read in this section is applicable to
your HellHound application as well.</p>
</div>
<div class="sect3">
<h4 id="_routes_vs_routers"><a class="anchor" href="#_routes_vs_routers"></a>5.2.1. Routes vs. Routers</h4>
<div class="paragraph">
<p>HellHound distinguishes between routes and routers.</p>
</div>
<div class="paragraph">
<p>"Routes" are data that describe a structure of decisions to be made in handling requests.</p>
</div>
<div class="paragraph">
<p>"Routers" are the functions (supplied as Interceptors) that analyze incoming requests against the routes.</p>
</div>
<div class="paragraph">
<p>Pedestal uses protocols to connect routes to routers. Either can be varied independently.</p>
</div>
</div>
<div class="sect3">
<h4 id="_routes"><a class="anchor" href="#_routes"></a>5.2.2. Routes</h4>
<div class="paragraph">
<p>Routes are data used by routers. The <code>verbose syntax</code> is the form used directly by routers.
The <code>table</code> and <code>terse</code> syntaxes are convenient forms that can be expanded into the verbose syntax.</p>
</div>
<div class="paragraph">
<p>Users are free to describe routes however they like, so long as the data that reaches the router is in the <code>verbose syntax</code>.</p>
</div>
<div class="paragraph">
<p>The built in syntaxes are expanded by expand-routes polymorphically on the argument type:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Argument to <code>expand-routes</code></th>
<th class="tableblock halign-left valign-top">Syntax used</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Terse</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verbose</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>hellhound.http.route/expand-routes</code> is an alias for <code>io.pedestal.http.route/expand-routes</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_verbose_syntax"><a class="anchor" href="#_verbose_syntax"></a>5.2.3. Verbose Syntax</h4>
<div class="paragraph">
<p>The verbose syntax is a list of maps, with the following structure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">  {<span class="symbol">:route-name</span> <span class="symbol">:new-user</span>
   <span class="symbol">:app-name</span>   <span class="symbol">:example-app</span>        <span class="comment">; optional</span>
   <span class="symbol">:path</span>       <span class="string"><span class="delimiter">&quot;</span><span class="content">/user/:id/*blah</span><span class="delimiter">&quot;</span></span>   <span class="comment">; like Ruby on Rails</span>
                                   <span class="comment">; (catch-all route is &quot;/*path&quot;)</span>
   <span class="symbol">:method</span>     <span class="symbol">:post</span>               <span class="comment">; or :any, :get, :put, ...</span>
   <span class="symbol">:scheme</span>     <span class="symbol">:https</span>              <span class="comment">; optional</span>
   <span class="symbol">:host</span>       <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>       <span class="comment">; optional</span>
   <span class="symbol">:port</span>       <span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>              <span class="comment">; optional</span>
   <span class="symbol">:interceptors</span> [<span class="keyword">..</span><span class="keyword">.</span>]             <span class="comment">; vector of interceptors to be enqueued on the context</span>

   <span class="comment">;; Generated for path-matching:</span>
   <span class="symbol">:path-re</span>           <span class="regexp"><span class="delimiter">#&quot;</span><span class="content">/</span><span class="content">\Q</span><span class="content">user</span><span class="content">\E</span><span class="content">/([^/]+)/(.+)</span><span class="delimiter">&quot;</span></span>
   <span class="symbol">:path-parts</span>        [<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span> <span class="symbol">:id</span> <span class="symbol">:blah</span>]
   <span class="symbol">:path-params</span>       [<span class="symbol">:id</span> <span class="symbol">:blah</span>]
   <span class="symbol">:path-constraints</span>  {<span class="symbol">:id</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">([^/]+)</span><span class="delimiter">&quot;</span></span>
                       <span class="symbol">:blah</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">(.+)</span><span class="delimiter">&quot;</span></span>}
   <span class="symbol">:query-constraints</span> {<span class="symbol">:name</span> <span class="regexp"><span class="delimiter">#&quot;</span><span class="content">.+</span><span class="delimiter">&quot;</span></span>
                       <span class="symbol">:search</span> <span class="regexp"><span class="delimiter">#&quot;</span><span class="content">[0-9]+</span><span class="delimiter">&quot;</span></span>}
   }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>:route-name</code> must be unique.</p>
</div>
<div class="paragraph">
<p>The keys <code>:path-re</code>, <code>:path-parts</code>, <code>:path-params</code>, and
<code>:path-constraints</code> are derived from the <code>:path</code>.</p>
</div>
<div class="paragraph">
<p>Users will not generally write routes directly in verbose format.</p>
</div>
</div>
<div class="sect3">
<h4 id="_table_syntax"><a class="anchor" href="#_table_syntax"></a>5.2.4. Table Syntax</h4>
<div class="paragraph">
<p>Table syntax is expanded by
<a href="http://pedestal.io/api/pedestal.route/io.pedestal.http.route.html#var-expand-routes"><code>expand-routes</code></a>
into the full (verbose) syntax shown above.</p>
</div>
<div class="paragraph">
<p>When the argument to
<a href="http://pedestal.io/api/pedestal.route/io.pedestal.http.route.html#var-expand-routes"><code>expand-routes</code></a>
is a <strong>set</strong>, it will be expanded using the table syntax.</p>
</div>
<div class="paragraph">
<p>In table syntax, each route is a vector of:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Path string</p>
</li>
<li>
<p>Verb. One of :any, :get, :put, :post, :delete, :patch, :options, :head</p>
</li>
<li>
<p>Handler or vector of interceptors</p>
</li>
<li>
<p>Optional route name clause</p>
</li>
<li>
<p>Optional constraint clause</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">example.clj</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">  [<span class="string"><span class="delimiter">&quot;</span><span class="content">/user/:id/*blah</span><span class="delimiter">&quot;</span></span>  <span class="symbol">:post</span>  [<span class="keyword">..</span><span class="keyword">.</span>] <span class="symbol">:route-name</span> <span class="symbol">:new-user</span> <span class="symbol">:constraints</span> {<span class="symbol">:id</span> <span class="regexp"><span class="delimiter">#&quot;</span><span class="content">[0-9]+</span><span class="delimiter">&quot;</span></span>}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>:host</code>, <code>:port</code>, <code>:app-name</code>, and <code>:scheme</code> are provided in a map that applies to all routes in the list.</p>
</div>
<div class="listingblock">
<div class="title">example.clj</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(route/expand-routes
  #{{<span class="symbol">:host</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span> <span class="symbol">:scheme</span> <span class="symbol">:https</span>}
    [<span class="string"><span class="delimiter">&quot;</span><span class="content">/user/:id/*blah</span><span class="delimiter">&quot;</span></span>  <span class="symbol">:post</span>  [<span class="keyword">..</span><span class="keyword">.</span>] <span class="symbol">:route-name</span> <span class="symbol">:new-user</span> <span class="symbol">:constraints</span> {<span class="symbol">:id</span> <span class="regexp"><span class="delimiter">#&quot;</span><span class="content">[0-9]+</span><span class="delimiter">&quot;</span></span>}]})</code></pre>
</div>
</div>
<div class="paragraph">
<p>When multiple routes use the same path, they must differ by both verb and route name.</p>
</div>
<div class="listingblock">
<div class="title">example.clj</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">    [<span class="string"><span class="delimiter">&quot;</span><span class="content">/user/:id</span><span class="delimiter">&quot;</span></span>  <span class="symbol">:post</span> new-user  <span class="symbol">:route-name</span> <span class="symbol">:new-user</span>  <span class="symbol">:constraints</span> {<span class="symbol">:id</span> <span class="regexp"><span class="delimiter">#&quot;</span><span class="content">[0-9]+</span><span class="delimiter">&quot;</span></span>}]
    [<span class="string"><span class="delimiter">&quot;</span><span class="content">/user/:id</span><span class="delimiter">&quot;</span></span>  <span class="symbol">:get</span>  view-user <span class="symbol">:route-name</span> <span class="symbol">:view-user</span> <span class="symbol">:constraints</span> {<span class="symbol">:id</span> <span class="regexp"><span class="delimiter">#&quot;</span><span class="content">[0-9]+</span><span class="delimiter">&quot;</span></span>}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the last interceptor in the chain has a name, or you supply a
symbol that resolves to a function or named interceptor, then the
route name will be derived from that.</p>
</div>
<div class="listingblock">
<div class="title">example.clj</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">    <span class="comment">;; Route names will be taken from the symbols</span>
    (<span class="keyword">defn</span> <span class="function">new-user</span> [request] ,,,)
    (<span class="keyword">defn</span> <span class="function">view-user</span> [request] ,,,)

    (route/expand-routes
      #{[<span class="string"><span class="delimiter">&quot;</span><span class="content">/user/:id</span><span class="delimiter">&quot;</span></span>  <span class="symbol">:post</span> [,,, `new-user]  <span class="symbol">:constraints</span> {<span class="symbol">:id</span> <span class="regexp"><span class="delimiter">#&quot;</span><span class="content">[0-9]+</span><span class="delimiter">&quot;</span></span>}]
        [<span class="string"><span class="delimiter">&quot;</span><span class="content">/user/:id</span><span class="delimiter">&quot;</span></span>  <span class="symbol">:get</span>  [,,, `view-user] <span class="symbol">:constraints</span> {<span class="symbol">:id</span> <span class="regexp"><span class="delimiter">#&quot;</span><span class="content">[0-9]+</span><span class="delimiter">&quot;</span></span>}]})

    <span class="comment">;; Route names will be taken from the interceptors</span>
    (<span class="keyword">def</span> <span class="function">new-user-intc</span> {<span class="symbol">:name</span> <span class="symbol">:new-user</span> <span class="symbol">:enter</span> (<span class="keyword">fn</span> [context] ,,,)})
    (<span class="keyword">def</span> <span class="function">view-user-intc</span> {<span class="symbol">:name</span> <span class="symbol">:view-user</span> <span class="symbol">:enter</span> (<span class="keyword">fn</span> [context] ,,,)})

    (route/expand-routes
      #{[<span class="string"><span class="delimiter">&quot;</span><span class="content">/user/:id</span><span class="delimiter">&quot;</span></span>  <span class="symbol">:post</span> [,,, new-user-intc]  <span class="symbol">:constraints</span> {<span class="symbol">:id</span> <span class="regexp"><span class="delimiter">#&quot;</span><span class="content">[0-9]+</span><span class="delimiter">&quot;</span></span>}]
        [<span class="string"><span class="delimiter">&quot;</span><span class="content">/user/:id</span><span class="delimiter">&quot;</span></span>  <span class="symbol">:get</span>  [,,, view-user-intc] <span class="symbol">:constraints</span> {<span class="symbol">:id</span> <span class="regexp"><span class="delimiter">#&quot;</span><span class="content">[0-9]+</span><span class="delimiter">&quot;</span></span>}]})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_terse_syntax"><a class="anchor" href="#_terse_syntax"></a>5.2.5. Terse Syntax</h4>
<div class="paragraph">
<p>Terse syntax is expanded by
<a href="http://pedestal.io/api/pedestal.route/io.pedestal.http.route.html#var-expand-routes"><code>expand-routes</code></a>
into the full (verbose) syntax shown above.</p>
</div>
<div class="paragraph">
<p>When the argument to
<a href="http://pedestal.io/api/pedestal.route/io.pedestal.http.route.html#var-expand-routes"><code>expand-routes</code></a>
is a <strong>vector</strong>, it will be expanded using the terse syntax.</p>
</div>
<div class="paragraph">
<p>In the terse format, a route table is a vector of nested vectors. Each
top-level vector describes an "application". The application vector
contain the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(Optional) A keyword identifying the application by name</p>
</li>
<li>
<p>(Optional) A URL scheme</p>
</li>
<li>
<p>(Optional) A host name</p>
</li>
<li>
<p>One or more nested vectors specifying routes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">example.clj</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="comment">;; Application vector with one route vector (which has one route)</span>
[[<span class="symbol">:hello-world</span> <span class="symbol">:http</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>
 [<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello-world</span><span class="delimiter">&quot;</span></span> {<span class="symbol">:get</span> hello-world}]]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Route vectors can be nested arbitrarily deep. Each vector adds a path
segment. The nesting structure of the route vectors maps to the
hierarchic tree structure of the routes.</p>
</div>
<div class="paragraph">
<p>Each route vector contains the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A path segment. This must begin with a slash.</p>
</li>
<li>
<p>(Optional) Interceptor metadata for the verb map.</p>
</li>
<li>
<p>(Optional) Constraint metadata for the verb map.</p>
</li>
<li>
<p>A verb map</p>
</li>
<li>
<p>Zero or more child route vectors</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The allowed keys in a verb map are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>:get</p>
</li>
<li>
<p>:put</p>
</li>
<li>
<p>:post</p>
</li>
<li>
<p>:delete</p>
</li>
<li>
<p>:any</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The value of each key is either a handler function or a list of interceptors.</p>
</div>
<div class="paragraph">
<p>Each verb in the verb map defines a route on the path. This example
defines four routes.</p>
</div>
<div class="listingblock">
<div class="title">example.clj</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">[[<span class="symbol">:hello-world</span> <span class="symbol">:http</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>
 [<span class="string"><span class="delimiter">&quot;</span><span class="content">/order</span><span class="delimiter">&quot;</span></span> {<span class="symbol">:get</span> list-orders
            <span class="symbol">:post</span> create-order}
   [<span class="string"><span class="delimiter">&quot;</span><span class="content">/:id</span><span class="delimiter">&quot;</span></span> {<span class="symbol">:get</span> view-order
            <span class="symbol">:put</span> update-order}]]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Interceptor metadata applies to every route in the verb map. In this
example <code>load-order-from-db</code> applies to both the <code>:get</code> and <code>:put</code>
routes for the path "/order/:id"</p>
</div>
<div class="listingblock">
<div class="title">example.clj</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">[[<span class="symbol">:hello-world</span> <span class="symbol">:http</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>
 [<span class="string"><span class="delimiter">&quot;</span><span class="content">/order</span><span class="delimiter">&quot;</span></span> {<span class="symbol">:get</span> list-orders
            <span class="symbol">:post</span> create-order}
   [<span class="string"><span class="delimiter">&quot;</span><span class="content">/:id</span><span class="delimiter">&quot;</span></span> ^{<span class="symbol">:interceptors</span> [load-order-from-db]
             <span class="symbol">:constraints</span>  {<span class="symbol">:id</span> <span class="regexp"><span class="delimiter">#&quot;</span><span class="content">[0-9]+</span><span class="delimiter">&quot;</span></span>}}
           {<span class="symbol">:get</span> view-order
            <span class="symbol">:put</span> update-order}]]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>(Recall that metadata is attached to the <em>next</em> data structure
read. The metadata with constraints and interceptors will be attached
to the verb map.)</p>
</div>
<div class="paragraph">
<p>If multiple routes have the same handler, you will need to distinguish
them by providing route names. (This is necessary so URL generation
knows which route to use.) A route name is a keyword that goes in the
first position of an interceptor vector in the verb map. In the
following example, both POST routes have the same handler. We provide
the keywords <code>:post-without-id</code> and <code>:post-by-id</code> to distinguish the
routes.</p>
</div>
<div class="listingblock">
<div class="title">example.clj</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">[[<span class="symbol">:hello-world</span> <span class="symbol">:http</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">example.com</span><span class="delimiter">&quot;</span></span>
 [<span class="string"><span class="delimiter">&quot;</span><span class="content">/order</span><span class="delimiter">&quot;</span></span> {<span class="symbol">:get</span>  list-orders
            <span class="symbol">:post</span> [<span class="symbol">:post-without-id</span> create-order]}
   [<span class="string"><span class="delimiter">&quot;</span><span class="content">/:id</span><span class="delimiter">&quot;</span></span> {<span class="symbol">:get</span>  query-order
            <span class="symbol">:post</span> [<span class="symbol">:post-by-id</span> create-order]}]]]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_routers"><a class="anchor" href="#_routers"></a>5.3. Routers</h3>
<div class="paragraph">
<p>When your application starts a Pedestal service with <a href="../api/pedestal.service/io.pedestal.http.html#var-create-servlet"><code>create-servlet</code></a> or <a href="../api/pedestal.service/io.pedestal.http.html#var-create-server"><code>create-server</code></a>, Pedestal creates a router, using the following keys from the service map:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:io.pedestal.http/routes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Routes as described above</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:io.pedestal.http/router</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key to select a router, or a function that constructs a router</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the value of <code>:io.pedestal.http/router</code> is a keyword, it selects
one of the built in routers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>:map-tree</code></p>
</li>
<li>
<p><code>:prefix-tree</code></p>
</li>
<li>
<p><code>:linear-search</code></p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Router</th>
<th class="tableblock halign-left valign-top">Performance</th>
<th class="tableblock halign-left valign-top">Scaling in # Routes</th>
<th class="tableblock halign-left valign-top">Limitations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map Tree</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Very fast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applies when all routes are static. Falls back to prefix tree if any routes have path parameters or wildcards.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefix Tree</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">High performance, space efficient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log32(N)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wildcard routes always win over explicit paths in the same subtree. E.g., <code>/path/:wild</code> will always match, even if <code>/path/user</code> is defined</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linear Search</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lowest performance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O(N)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Routes are checked in order. Precedence is precise.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_custom_router"><a class="anchor" href="#_custom_router"></a>5.3.1. Custom Router</h4>
<div class="paragraph">
<p>When the value of <code>:io.pedestal.http/router</code> is a function, that
function is used to construct a router. The function must take one
argument: the collection of fully expanded routes. It must return
something that satisfies the
<a href="http://pedestal.io/api/pedestal.route/io.pedestal.http.route.router.html#var-Router"><code>Router</code></a>
protocol.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples_2"><a class="anchor" href="#_examples_2"></a>5.4. Examples</h3>
<div class="paragraph">
<p>Now it&#8217;s time to see HTTP package in action. Let&#8217;s start from simple to hard.</p>
</div>
<div class="sect3">
<h4 id="_echo_server"><a class="anchor" href="#_echo_server"></a>5.4.1. Echo Server</h4>
<div class="paragraph">
<p>In this example we&#8217;re going to create a really simple system which contains
a hellhound webserver which reponds with what is gets via the ws connection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As you already know, HellHound communications happens over websocket connection which creates by the
<code>hellhound.components.webserver</code> component.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to execute the following example from the <a href="https://github.com/Codamic/hellhound_examples">hellhound_examples</a>
repository. Just issue the following command in the repository root directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ lein run -m components.webserver-example1/main</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ok let&#8217;s jump into the code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td>
  <td class="code"><pre>(<span class="keyword">ns</span> <span class="namespace">components.webserver-example1</span>
  (<span class="symbol">:require</span>
   [hellhound.system <span class="symbol">:as</span> system]
   [hellhound.component <span class="symbol">:as</span> hcomp]
   [hellhound.components.webserver <span class="symbol">:as</span> web] <i class="conum" data-value="1"></i><b>(1)</b>
   [hellhound.components.transform <span class="symbol">:as</span> transform] <i class="conum" data-value="2"></i><b>(2)</b>
   [hellhound.http <span class="symbol">:as</span> http]
   [manifold.stream <span class="symbol">:as</span> s]))

<span class="comment">;; System definition.</span>
(<span class="keyword">def</span> <span class="function">system</span>
  {<span class="symbol">:components</span>
   [(web/factory http/default-routes) <i class="conum" data-value="3"></i><b>(3)</b>
    (transform/factory <span class="symbol">::output</span> <i class="conum" data-value="4"></i><b>(4)</b>
                       (<span class="keyword">fn</span> [context msg]
                         (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">RECEIVED: </span><span class="delimiter">&quot;</span></span> msg)
                         msg))]

   <span class="symbol">:workflow</span> [[<span class="symbol">::web/webserver</span>  <span class="symbol">::output</span>]
              [<span class="symbol">::output</span> <span class="symbol">::web/webserver</span>]]}) <i class="conum" data-value="5"></i><b>(5)</b>

(<span class="keyword">defn</span> <span class="function">main</span>
  []
  (system/set-system! system)
  (system/start!))</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>HellHound&#8217;s webserver component ns.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>HellHound&#8217;s transform component ns.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Webserver component. The name of this component
would be <code>::hellhound.components.webserver/webserver</code>
We used <code>hellhound.http/default-routes</code> as the routes
definition. But you can provide your own routes as long
as it contains the hellhound websocket endpoint.
Also as a shortcut you can use <code>hellhound.components.webserver/default-factory</code>.
It&#8217;s just a shortcut around <code>hellhound.components.webserver/factory</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Transform component is a very simple component which redirects
incoming messages from input stream to output stream and applies
the given function to each message.
In this case we don&#8217;t do any transformation. We just log the message.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>A closed workflow. In this workflow the output of <code>::output</code>
component would be the input of <code>::web/webserver</code> component
while the output of <code>::web/webserver</code> would be the input
of <code>::output</code>. The important thing to remember in this example
is that basically the output of the webserver component is a
stream of data which receives from clients via websocket.
other requests to none websocket endpoint handle synchronously
by pedestal interceptors. In general we highly recommend to avoid
this situation and implement your views in client side which is
connected to HellHound server by a websocket</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run the example code and then use below code in your browser console to test the echo server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
</pre></td>
  <td class="code"><pre>ws = <span class="keyword">new</span> WebSocket(<span class="string"><span class="delimiter">&quot;</span><span class="content">ws://localhost:3000/ws</span><span class="delimiter">&quot;</span></span>)
ws.<span class="function">onmessage</span> = <span class="keyword">function</span>(e) { console.log(e.data) }
ws.send(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello world</span><span class="delimiter">&quot;</span></span>)</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>After running the above code you&#8217;re going to see "hello world" on your js console.</p>
</div>
<div class="paragraph">
<p>In this example data flow from webserver component to the output component and back
to webserver component as the input and webserver component send its input to the client
side application using the ws connection.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisite"><a class="anchor" href="#_prerequisite"></a>Appendix A: Prerequisite</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before learning more about <strong>HellHound</strong> and how to use it, you need to know about several concepts and libraries in advance
which are heavily used in <strong>HellHound</strong>. If you already know about tools and concepts such as Manifold, Deffered and Stream
just skip to <a href="#_getting_started">Getting Started</a> section, Otherwise please read this section first.</p>
</div>
<div class="sect2">
<h3 id="_commander_pattern"><a class="anchor" href="#_commander_pattern"></a>A.1. Commander Pattern</h3>
<div class="paragraph">
<p>Have you ever hit a wall with REST? Does modeling your problem-domain into CRUD-able entities feel like fitting
a square peg into a round hole? Perhaps, instead of modeling our services like little databases, we should instead
model them like reactors over immutable event streams.</p>
</div>
<div class="paragraph">
<p>Commander pattern is an application architecture design pattern. In order to know more
about the concept, it is highly recommend to watch this <a href="https://www.youtube.com/watch?v=B1-gS0oEtYc">video</a>.</p>
</div>
<div class="paragraph">
<p>HellHound heavily inspired from this pattern.</p>
</div>
</div>
<div class="sect2">
<h3 id="_manifold"><a class="anchor" href="#_manifold"></a>A.2. Manifold</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Most of the documentation about Manifold library have been taken and from it&#8217;s official documentation and modified
to make the life of the user easier. Kudos to the authors of Manifold.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This library provides basic building blocks for asynchronous programming, and can be used as a translation layer
between libraries which use similar but incompatible abstractions. Manifold provides two core abstractions:
<strong>deferreds</strong>, which represent a single asynchronous value, and <strong>streams</strong>, which represent an ordered sequence
of asynchronous values.</p>
</div>
<div class="paragraph">
<p><strong>HellHound</strong> uses manifolds almost everywhere, so it&#8217;s a good idea learn about this fantastic library which is brought to us
by <a href="https://github.com/ztellman">@ztellman</a> and the awesome <a href="https://github.com/ztellman/manifold/graphs/contributors">contributors</a>
of this library.</p>
</div>
<div class="paragraph">
<p>Long story short, <strong>Manifold</strong> library provides awesome asynchronous values by <strong>deferreds</strong> and a super useful abstraction
for <strong>streams</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you&#8217;re interested in Manifold, you might want to know about the <a href="http://aleph.io/manifold/rationale.html">rationale</a> behind it.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_deferred"><a class="anchor" href="#_deferred"></a>A.3. Deferred</h3>
<div class="paragraph">
<p>A deferred in Manifold is similar to a Clojure promise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">require</span> '[manifold.deferred <span class="symbol">:as</span> d])
<span class="predefined-constant">nil</span>

<span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">d</span> (d/deferred))
<span class="error">#</span>'d

<span class="keyword">&gt;</span> (d/success! d <span class="symbol">:foo</span>)
<span class="predefined-constant">true</span>

<span class="keyword">&gt;</span> @d
<span class="symbol">:foo</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, similar to Clojure&#8217;s futures, deferreds in Manifold can also represent errors. Crucially, they also allow for
callbacks to be registered, rather than simply blocking on dereferencing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">d</span> (d/deferred))
<span class="error">#</span>'d

<span class="keyword">&gt;</span> (d/error! d (Exception. <span class="string"><span class="delimiter">&quot;</span><span class="content">boom</span><span class="delimiter">&quot;</span></span>))
<span class="predefined-constant">true</span>

<span class="keyword">&gt;</span> @d
Exception<span class="error">:</span> boom</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">d</span> (d/deferred))
<span class="error">#</span>'d

<span class="keyword">&gt;</span> (d/on-realized d
    (<span class="keyword">fn</span> [x] (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">success!</span><span class="delimiter">&quot;</span></span> x))
    (<span class="keyword">fn</span> [x] (<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">error!</span><span class="delimiter">&quot;</span></span> x)))
&lt;&lt; <span class="keyword">..</span><span class="keyword">.</span> &gt;&gt;

<span class="keyword">&gt;</span> (d/success! d <span class="symbol">:foo</span>)
success! <span class="symbol">:foo</span>
<span class="predefined-constant">true</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_composing_with_deferreds"><a class="anchor" href="#_composing_with_deferreds"></a>A.3.1. composing with deferreds</h4>
<div class="paragraph">
<p>Callbacks are a useful building block, but they&#8217;re a painful way to create asynchronous workflows.  In practice, no one should ever use <code>on-realized</code>.</p>
</div>
<div class="paragraph">
<p>Instead, they should use <code>manifold.deferred/chain</code>, which chains together callbacks, left to right:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">d</span> (d/deferred))
<span class="error">#</span>'d

<span class="keyword">&gt;</span> (d/chain d <span class="keyword">inc</span> <span class="keyword">inc</span> <span class="keyword">inc</span> #(<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">x + 3 =</span><span class="delimiter">&quot;</span></span> %))
&lt;&lt; <span class="keyword">..</span><span class="keyword">.</span> &gt;&gt;

<span class="keyword">&gt;</span> (d/success! d <span class="integer">0</span>)
x <span class="keyword">+</span> <span class="integer">3</span> <span class="keyword">=</span> <span class="integer">3</span>
<span class="predefined-constant">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>chain</code> returns a deferred representing the return value of the right-most callback.  If any of the functions returns
a deferred or a value that can be coerced into a deferred, the chain will be paused until the deferred yields a value.</p>
</div>
<div class="paragraph">
<p>Values that can be coerced into a deferred include Clojure futures, Java futures, and Clojure promises.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">d</span> (d/deferred))
<span class="error">#</span>'d

<span class="keyword">&gt;</span> (d/chain d
    #(<span class="keyword">future</span> (<span class="keyword">inc</span> %))
    #(<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">the future returned</span><span class="delimiter">&quot;</span></span> %))
&lt;&lt; <span class="keyword">..</span><span class="keyword">.</span> &gt;&gt;

<span class="keyword">&gt;</span> (d/success! d <span class="integer">0</span>)
the <span class="keyword">future</span> returned <span class="integer">1</span>
<span class="predefined-constant">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If any stage in <code>chain</code> throws an exception or returns a deferred that yields an error, all subsequent stages are skipped,
and the deferred returned by <code>chain</code> yields that same error.  To handle these cases, you can use <code>manifold.deferred/catch</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">d</span> (d/deferred))
<span class="error">#</span>p

<span class="keyword">&gt;</span> (<span class="keyword">-&gt;</span> d
    (d/chain <span class="keyword">dec</span> #(<span class="keyword">/</span> <span class="integer">1</span> %))
    (d/catch Exception #(<span class="keyword">println</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">whoops, that didn't work:</span><span class="delimiter">&quot;</span></span> %)))
&lt;&lt; <span class="keyword">..</span><span class="keyword">.</span> &gt;&gt;

<span class="keyword">&gt;</span> (d/success! d <span class="integer">1</span>)
whoops, that didn't work<span class="error">:</span> <span class="error">#</span>error {<span class="symbol">:cause</span> Divide by zero <span class="symbol">:via</span> [{<span class="symbol">:type</span> java.lang.ArithmeticException <span class="keyword">..</span><span class="keyword">.</span>
<span class="predefined-constant">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>&#8594;</code> threading operator, <code>chain</code> and <code>catch</code> can be easily and arbitrarily composed.</p>
</div>
<div class="paragraph">
<p>To combine multiple deferrable values into a single deferred that yields all their results, we can use <code>manifold.deferred/zip</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> @(d/zip (<span class="keyword">future</span> <span class="integer">1</span>) (<span class="keyword">future</span> <span class="integer">2</span>) (<span class="keyword">future</span> <span class="integer">3</span>))
(<span class="integer">1</span> <span class="integer">2</span> <span class="integer">3</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we can use <code>manifold.deferred/timeout!</code> to register a timeout on the deferred which will yield either a specified timeout value or
a <code>TimeoutException</code> if the deferred is not realized within <code>n</code> milliseconds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> @(d/timeout!
     (d/future (Thread/sleep <span class="integer">1000</span>) <span class="symbol">:foo</span>)
     <span class="integer">100</span>
     <span class="symbol">:bar</span>)
<span class="symbol">:bar</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that if a timeout is placed on a deferred returned by <code>chain</code>, the timeout elapsing will prevent any further stages from being executed.</p>
</div>
<div class="sect4">
<h5 id="_code_future_code_vs_code_manifold_deferred_future_code"><a class="anchor" href="#_code_future_code_vs_code_manifold_deferred_future_code"></a><code>future</code> vs <code>manifold.deferred/future</code></h5>
<div class="paragraph">
<p>Clojure&#8217;s futures can be treated as deferreds, as can Clojure&#8217;s promises.  However, since both of these abstractions use a blocking dereference,
in order for Manifold to treat it as an asynchronous deferred value it must allocate a thread.</p>
</div>
<div class="paragraph">
<p>Wherever possible, use <code>manifold.deferred/deferred</code> instead of <code>promise</code>, and <code>manifold.deferred/future</code> instead of <code>future</code>.  They will behave
identically to their Clojure counterparts (<code>deliver</code> can be used on a Manifold deferred, for instance), but allow for callbacks to be registered,
so no additional threads are required.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_let_flow"><a class="anchor" href="#_let_flow"></a>A.3.2. let-flow</h4>
<div class="paragraph">
<p>Let&#8217;s say that we have two services which provide us numbers, and want to get their sum.  By using <code>zip</code> and <code>chain</code> together, this is relatively straightforward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">defn</span> <span class="function">deferred-sum</span> []
  (<span class="keyword">let</span> [a (call-service-a)
        b (call-service-b)]
    (chain (zip a b)
      (<span class="keyword">fn</span> [[a b]]
        (<span class="keyword">+</span> a b)))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, this isn&#8217;t a very direct expression of what we&#8217;re doing.  For more complex relationships between deferred values,
our code will become even more difficult to understand.  In these cases, it&#8217;s often best to use <code>let-flow</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">defn</span> <span class="function">deferred-sum</span> []
  (let-flow [a (call-service-a)
             b (call-service-b)]
    (<span class="keyword">+</span> a b)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <code>let-flow</code>, we can treat deferred values as if they&#8217;re realized.  This is only true of values declared within or closed over by <code>let-flow</code>, however.  So we can do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">let</span> [a (<span class="keyword">future</span> <span class="integer">1</span>)]
  (let-flow [b (<span class="keyword">future</span> (<span class="keyword">+</span> a <span class="integer">1</span>))
             c (<span class="keyword">+</span> b <span class="integer">1</span>)]
    (<span class="keyword">+</span> c <span class="integer">1</span>)))</code></pre>
</div>
</div>
<div class="paragraph">
<p>but not this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(let-flow [a (<span class="keyword">future</span> <span class="integer">1</span>)
           b (<span class="keyword">let</span> [c (<span class="keyword">future</span> <span class="integer">1</span>)]
                (<span class="keyword">+</span> a c))]
  (<span class="keyword">+</span> b <span class="integer">1</span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>c</code> is declared within a normal <code>let</code> binding, and as such we can&#8217;t treat it as if it were realized.</p>
</div>
<div class="paragraph">
<p>It can be helpful to think of <code>let-flow</code> as similar to Prismatic&#8217;s
<a href="https://github.com/prismatic/plumbing#graph-the-functional-swiss-army-knife">Graph</a> library, except that the dependencies
between values are inferred from the code, rather than explicitly specified.  Comparisons to core.async&#8217;s goroutines are
less accurate, since <code>let-flow</code> allows for concurrent execution of independent paths within the bindings, whereas
operations within a goroutine are inherently sequential.</p>
</div>
<div class="sect4">
<h5 id="_code_manifold_deferred_loop_code"><a class="anchor" href="#_code_manifold_deferred_loop_code"></a><code>manifold.deferred/loop</code></h5>
<div class="paragraph">
<p>Manifold also provides a <code>loop</code> macro, which allows for asynchronous loops to be defined.  Consider
<code>manifold.stream/consume</code>, which allows a function to be invoked with each new message from a stream.  We can implement
similar behavior like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure">(<span class="keyword">require</span>
  '[manifold.deferred <span class="symbol">:as</span> d]
  '[manifold.stream <span class="symbol">:as</span> s])

(<span class="keyword">defn</span> <span class="function">my-consume</span> [f stream]
  (d/loop []
    (d/chain (s/take! stream <span class="symbol">::drained</span>)

      <span class="comment">;; if we got a message, run it through `f`</span>
      (<span class="keyword">fn</span> [msg]
        (<span class="keyword">if</span> (<span class="keyword">identical?</span> <span class="symbol">::drained</span> msg)
          <span class="symbol">::drained</span>
          (f msg)))

      <span class="comment">;; wait for the result from `f` to be realized, and</span>
      <span class="comment">;; recur, unless the stream is already drained</span>
      (<span class="keyword">fn</span> [result]
        (<span class="keyword">when-not</span> (<span class="keyword">identical?</span> <span class="symbol">::drained</span> result)
          (d/recur))))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we define a loop which takes messages one at a time from <code>stream</code>, and passes them into <code>f</code>.  If <code>f</code> returns an unrealized value, the loop will pause until it&#8217;s realized.  To recur, we make sure the value returned from the final stage is <code>(manifold.deferred/recur &amp; args)</code>, which will cause the loop to begin again from the top.</p>
</div>
<div class="paragraph">
<p>While Manifold doesn&#8217;t provide anything as general purpose as core.async&#8217;s <code>go</code> macro, the combination of <code>loop</code> and <code>let-flow</code> can allow for the specification of highly intricate asynchronous workflows.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_custom_execution_models"><a class="anchor" href="#_custom_execution_models"></a>A.3.3. custom execution models</h4>
<div class="paragraph">
<p>Both deferreds and streams allow for custom execution models to be specified.  To learn more, //aleph.io/docs/execution.md[go here].</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stream"><a class="anchor" href="#_stream"></a>A.4. Stream</h3>
<div class="paragraph">
<p>A Manifold stream can be created using <code>manifold.stream/stream</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">require</span> '[manifold.stream <span class="symbol">:as</span> s])
<span class="predefined-constant">nil</span>
<span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">s</span> (s/stream))
<span class="error">#</span>'s</code></pre>
</div>
</div>
<div class="paragraph">
<p>A stream can be thought of as two separate halves: a <strong>sink</strong>  which consumes messages, and a <strong>source</strong>  which produces them.
We can <code>put!</code> messages into the sink, and <code>take!</code> them from the source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (s/put! s <span class="integer">1</span>)
&lt;&lt; <span class="keyword">..</span><span class="keyword">.</span> &gt;&gt;
<span class="keyword">&gt;</span> (s/take! s)
&lt;&lt; <span class="integer">1</span> &gt;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that both <code>put!</code> and <code>take!</code> return //aleph.io/manifold/deferred.md[deferred values].  The deferred returned by <code>put!</code> will yield
<code>true</code> if the message was accepted by the stream, and <code>false</code> otherwise; the deferred returned by <code>take!</code> will yield the message.</p>
</div>
<div class="paragraph">
<p>Sinks can be <strong>closed</strong> by calling <code>close!</code>, which means they will no longer accept messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (s/close! s)
<span class="predefined-constant">nil</span>
<span class="keyword">&gt;</span> @(s/put! s <span class="integer">1</span>)
<span class="predefined-constant">false</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can check if a sink is closed by calling <code>closed?</code>, and register a no-arg callback using <code>on-closed</code> to be notified when
the sink is closed.</p>
</div>
<div class="paragraph">
<p>Sources that will never produce any more messages (often because the corresponding sink is closed) are said to be <strong>drained</strong>.
We may check whether a source is drained via <code>drained?</code> and <code>on-drained</code>.</p>
</div>
<div class="paragraph">
<p>By default, calling <code>take!</code> on a drained source will yield a message of <code>nil</code>.  However, if <code>nil</code> is a valid message, we may
want to specify some other return value to denote that the source is drained:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> @(s/take! s <span class="symbol">::drained</span>)
<span class="symbol">::drained</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We may also want to put a time limit on how long we&#8217;re willing to wait on our put or take to complete.  For this, we can use
<code>try-put!</code> and <code>try-take!</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">s</span> (s/stream))
<span class="error">#</span>'s
<span class="keyword">&gt;</span> @(s/try-put! s <span class="symbol">:foo</span> <span class="integer">1000</span> <span class="symbol">::timeout</span>)
<span class="symbol">::timeout</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we try to put a message into the stream, but since there are no consumers, it will fail after waiting for 1000ms.  Here
we&#8217;ve specified <code>::timeout</code> as our special timeout value, otherwise, it would simply return <code>false</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> @(s/try-take! s <span class="symbol">::drained</span> <span class="integer">1000</span> <span class="symbol">::timeout</span>)
<span class="symbol">::timeout</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, we specify the timeout and special timeout value.  When using <code>try-take!</code>, we must specify return values for both the
drained and timeout outcomes.</p>
</div>
<div class="sect3">
<h4 id="_stream_operators"><a class="anchor" href="#_stream_operators"></a>A.4.1. stream operators</h4>
<div class="paragraph">
<p>The simplest thing we can do a stream is consumed every message that comes into it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (s/consume #(<span class="keyword">prn</span> 'message! %) s)
<span class="predefined-constant">nil</span>
<span class="keyword">&gt;</span> @(s/put! s <span class="integer">1</span>)
message! <span class="integer">1</span>
<span class="predefined-constant">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, we can also create derivative streams using operators analogous to Clojure&#8217;s sequence operators, a full list of
which [can be found here](<a href="http://ideolalia.com/manifold/" class="bare">http://ideolalia.com/manifold/</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">-&gt;&gt;</span> [<span class="integer">1</span> <span class="integer">2</span> <span class="integer">3</span>]
    s/-&gt;source
    (s/map <span class="keyword">inc</span>)
    s/stream-&gt;seq)
(<span class="integer">2</span> <span class="integer">3</span> <span class="integer">4</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we&#8217;ve mapped <code>inc</code> over a stream, transforming from a sequence to a stream and then back to a sequence for the sake of
a concise example.  Note that calling <code>manifold.stream/map</code> on a sequence will automatically call <code>&#8594;source</code>, so we can actually omit that, leaving just:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">-&gt;&gt;</span> [<span class="integer">1</span> <span class="integer">2</span> <span class="integer">3</span>]
    (s/map <span class="keyword">inc</span>)
    s/stream-&gt;seq)
(<span class="integer">2</span> <span class="integer">3</span> <span class="integer">4</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since streams are not immutable, in order to treat it as a sequence we must do an explicit transformation via <code>stream&#8594;seq</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">-&gt;&gt;</span> [<span class="integer">1</span> <span class="integer">2</span> <span class="integer">3</span>]
    s/-&gt;source
    s/stream-&gt;seq
    (<span class="keyword">map</span> <span class="keyword">inc</span>))
(<span class="integer">2</span> <span class="integer">3</span> <span class="integer">4</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we can create multiple derived streams from the same source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">s</span> (s/stream))
<span class="error">#</span>'s
<span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">a</span> (s/map <span class="keyword">inc</span> s))
<span class="error">#</span>'a
<span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">b</span> (s/map <span class="keyword">dec</span> s))
<span class="error">#</span>'b
<span class="keyword">&gt;</span> @(s/put! s <span class="integer">0</span>)
<span class="predefined-constant">true</span>
<span class="keyword">&gt;</span> @(s/take! a)
<span class="integer">1</span>
<span class="keyword">&gt;</span> @(s/take! b)
<span class="integer">-1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we create a source stream <code>s</code>, and map <code>inc</code> and <code>dec</code> over it.  When we put our message into <code>s</code> it immediately is accepted, since
<code>a</code> and <code>b</code> are downstream.  All messages put into <code>s</code> will be propagated into <strong>both</strong> <code>a</code> and <code>b</code>.</p>
</div>
<div class="paragraph">
<p>If <code>s</code> is closed, both <code>a</code> and <code>b</code> will be closed, as will any other downstream sources we&#8217;ve created.  Likewise, if everything downstream
of <code>s</code> is closed, <code>s</code> will also be closed.  This is almost always desirable, as failing to do this will simply cause <code>s</code> to exert
back pressure on everything upstream of it.  However, If we wish to avoid this behavior, we can create a <code>(permanent-stream)</code>, which cannot be closed.</p>
</div>
<div class="paragraph">
<p>For any Clojure operation that doesn&#8217;t have an equivalent in <code>manifold.stream</code>, we can use <code>manifold.stream/transform</code> with a transducer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">-&gt;&gt;</span> [<span class="integer">1</span> <span class="integer">2</span> <span class="integer">3</span>]
    (s/transform (<span class="keyword">map</span> <span class="keyword">inc</span>))
    s/stream-&gt;seq)
(<span class="integer">2</span> <span class="integer">3</span> <span class="integer">4</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s also <code>(periodically period f)</code>, which behaves like <code>(repeatedly f)</code>, but will emit the result of <code>(f)</code> every <code>period</code> milliseconds.</p>
</div>
</div>
<div class="sect3">
<h4 id="_connecting_streams"><a class="anchor" href="#_connecting_streams"></a>A.4.2. connecting streams</h4>
<div class="paragraph">
<p>Having created an event source through composition of operators, we will often want to feed all messages into a sink.  This can be
accomplished via <code>connect</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">a</span> (s/stream))
<span class="error">#</span>'a
<span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">b</span> (s/stream))
<span class="error">#</span>'b
<span class="keyword">&gt;</span> (s/connect a b)
<span class="predefined-constant">true</span>
<span class="keyword">&gt;</span> @(s/put! a <span class="integer">1</span>)
<span class="predefined-constant">true</span>
<span class="keyword">&gt;</span> @(s/take! b)
<span class="integer">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, we see that our message is immediately accepted into <code>a</code>, and can be read from <code>b</code>.  We may also pass an options map into
<code>connect</code>, with any of the following keys:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>downstream?</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">whether the source closing will close the sink, defaults to <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>upstream?</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">whether the sink closing will close the source, <strong>even if there are other sinks downstream of the source</strong>, defaults to <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the maximum time that will be spent waiting to convey a message into the sink before the connection is severed, defaults to <code>nil</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a description of the connection between the source and sink, useful for introspection purposes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Upon connecting two streams, we can inspect any of the streams using <code>description</code>, and follow the flow of data using <code>downstream</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">a</span> (s/stream))
<span class="error">#</span>'a
<span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">b</span> (s/stream))
<span class="error">#</span>'b
<span class="keyword">&gt;</span> (s/connect a b {<span class="symbol">:description</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">a connection</span><span class="delimiter">&quot;</span></span>})
<span class="predefined-constant">nil</span>
<span class="keyword">&gt;</span> (s/description a)
{<span class="symbol">:pending-puts</span> <span class="integer">0</span>, <span class="symbol">:drained?</span> <span class="predefined-constant">false</span>, <span class="symbol">:buffer-size</span> <span class="integer">0</span>, <span class="symbol">:permanent?</span> <span class="predefined-constant">false</span>, <span class="keyword">..</span><span class="keyword">.</span>}
<span class="keyword">&gt;</span> (s/downstream a)
([<span class="string"><span class="delimiter">&quot;</span><span class="content">a connection</span><span class="delimiter">&quot;</span></span> &lt;&lt; stream<span class="error">:</span> <span class="keyword">..</span><span class="keyword">.</span> &gt;&gt;])</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can recursively apply <code>downstream</code> to traverse the entire topology of our streams.  This can be a powerful way to reason about
the structure of our running processes, but sometimes we want to change the message from the source before it&#8217;s placed into the sink.
For this, we can use <code>connect-via</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">a</span> (s/stream))
<span class="error">#</span>'a
<span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">b</span> (s/stream))
<span class="error">#</span>'b
<span class="keyword">&gt;</span> (s/connect-via a #(s/put! b (<span class="keyword">inc</span> %)) b)
<span class="predefined-constant">nil</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>connect-via</code> takes an argument between the source and sink, which is a single-argument callback.  This callback will be
invoked with messages from the source, under the assumption that they will be propagated to the sink.  This is the underlying
mechanism for <code>map</code>, <code>filter</code>, and other stream operators; it allows us to create complex operations that are visible via <code>downstream</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="clojure"><span class="keyword">&gt;</span> (<span class="keyword">def</span> <span class="function">a</span> (s/stream))
<span class="error">#</span>'a
<span class="keyword">&gt;</span> (s/map <span class="keyword">inc</span> a)
&lt;&lt; source<span class="error">:</span> <span class="keyword">..</span><span class="keyword">.</span> &gt;&gt;
<span class="keyword">&gt;</span> (s/downstream a)
([{<span class="symbol">:op</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">map</span><span class="delimiter">&quot;</span></span>} &lt;&lt; sink<span class="error">:</span> {<span class="symbol">:type</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">callback</span><span class="delimiter">&quot;</span></span>} &gt;&gt;])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each element returned by <code>downstream</code> is a 2-tuple, the first element describing the connection, and the second element describing
the stream it&#8217;s feeding into.</p>
</div>
<div class="paragraph">
<p>The value returned by the callback for <code>connect-via</code> provides backpressure - if a deferred value is returned, further messages will
not be passed in until the deferred value is realized.</p>
</div>
</div>
<div class="sect3">
<h4 id="_buffers_and_backpressure"><a class="anchor" href="#_buffers_and_backpressure"></a>A.4.3. buffers and backpressure</h4>
<div class="paragraph">
<p>We saw above that if we attempt to put a message into a stream, it won&#8217;t succeed until the value is taken out.  This is because the
default stream has no buffer; it simply conveys messages from producers to consumers.  If we want to create a stream with a buffer,
we can simply call <code>(stream buffer-size)</code>.  We can also call <code>(buffer size stream)</code> to create a buffer downstream of an existing stream.</p>
</div>
<div class="paragraph">
<p>We may also call <code>(buffer metric limit stream)</code>, if we don&#8217;t want to measure our buffer&#8217;s size in messages.  If, for instance, each
message is a collection, we could use <code>count</code> as our metric, and set <code>limit</code> to whatever we want the maximum aggregate count to be.</p>
</div>
<div class="paragraph">
<p>To limit the rate of messages from a stream, we can use <code>(throttle max-rate stream)</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_event_buses_and_publish_subscribe_models"><a class="anchor" href="#_event_buses_and_publish_subscribe_models"></a>A.4.4. event buses and publish/subscribe models</h4>
<div class="paragraph">
<p>Manifold provides a simple publish/subscribe mechanism in the <code>manifold.bus</code> namespace.  To create an event bus, we can use
<code>(event-bus)</code>.  To publish to a particular topic on that bus, we use <code>(publish! bus topic msg)</code>.  To get a stream representing
all messages on a topic, we can call <code>(subscribe bus topic)</code>.</p>
</div>
<div class="paragraph">
<p>Calls to <code>publish!</code> will return a deferred that won&#8217;t be realized until all streams have accepted the message.  By default,
all streams returned by <code>subscribe</code> are unbuffered, but we can change this by providing a <code>stream-generator</code> to <code>event-bus</code>,
such as <code>(event-bus #(stream 1e3))</code>.  A short example of how <code>event-bus</code> can be used in concert with the buffering and flow control
mechanisms [can be found here](<a href="https://youtu.be/1bNOO3xxMc0?t=1887" class="bare">https://youtu.be/1bNOO3xxMc0?t=1887</a>).
n</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributing_to_hellhound"><a class="anchor" href="#_contributing_to_hellhound"></a>Appendix B: Contributing to HellHound</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Wow, thanks for your interest in helping out with HellHound. Let this document
serve as your guide.</p>
</div>
<div class="sect2">
<h3 id="_looking_for_work"><a class="anchor" href="#_looking_for_work"></a>B.1. Looking for work?</h3>
<div class="paragraph">
<p>If you&#8217;re looking for a task to work on, check out the
<a href="http://github.com/Codamic/hellhound/issues?labels=TODO">TODO</a> in our issues.</p>
</div>
<div class="paragraph">
<p>Less defined tasks will be marked with the
<a href="http://github.com/Codamic/hellhound/issues?labels=discuss">discuss label</a>. Jump in here if you want to be
a part of something big.</p>
</div>
</div>
<div class="sect2">
<h3 id="_new_features"><a class="anchor" href="#_new_features"></a>B.2. New Features</h3>
<div class="paragraph">
<p>HellHound is the thinking persons framework, so every contribution starts with
some <strong>deeeep</strong> thought. Finished?</p>
</div>
<div class="paragraph">
<p>Alright, your next step is to start a discussion.</p>
</div>
<div class="paragraph">
<p>Create an <a href="https://github.com/Codamic/hellhound/issues/new">issue</a> to start
a conversation. Tell us what you&#8217;re trying to accomplish and how you think you
might do it. If all is well, we&#8217;ll probably give you the :thumbsup: to
start developing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bugs"><a class="anchor" href="#_bugs"></a>B.3. Bugs</h3>
<div class="paragraph">
<p>Of course, if you run into any straight-up bugs or weirdness feel free to skip
the thinking (or at least too much of it) and immediately submit an <a href="https://github.com/codamic/hellhound/issues/new">issue</a>.</p>
</div>
<div class="paragraph">
<p>We have an issue template in place that will ask you some details
about the platform you are running and how to reproduce the bug. (If
you can reproduce it reliably. If not, go ahead and file the issue
anyway so we can start looking at it.)</p>
</div>
<div class="paragraph">
<p>Some of the usual stuff we&#8217;ll want to know:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What happened?</p>
<div class="ulist">
<ul>
<li>
<p>"I manifested a being from the outer dimensions."</p>
</li>
</ul>
</div>
</li>
<li>
<p>What did you expect to happen?</p>
<div class="ulist">
<ul>
<li>
<p>"Hello, world."</p>
</li>
</ul>
</div>
</li>
<li>
<p>How can you reprodice it?</p>
<div class="ulist">
<ul>
<li>
<p>"I created a new HellHound service with the template, then installed some code that Bob Howard gave me."</p>
</li>
</ul>
</div>
</li>
<li>
<p>What operating system and version are you using?</p>
<div class="ulist">
<ul>
<li>
<p>e.g. "OS X 10.8"</p>
</li>
</ul>
</div>
</li>
<li>
<p>What version of Clojure, Java, and Leiningen or Boot are you using?</p>
<div class="ulist">
<ul>
<li>
<p>e.g. "Leiningen 2.5.2 on Java 1.8.0_u40 Java HotSpot&#8482; 64-Bit Server VM"</p>
</li>
</ul>
</div>
</li>
<li>
<p>What HellHound version are you using?</p>
<div class="ulist">
<ul>
<li>
<p>e.g. "0.5.0"</p>
</li>
<li>
<p>or, for a SNAPSHOT: "0.5.1-SNAPSHOT at d0cf2b4"</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even better, include a link to a gist or repository where we can jump straight
to the problem.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tests"><a class="anchor" href="#_tests"></a>B.4. Tests</h3>
<div class="paragraph">
<p>&lt;PLACEHOLDER TEXT&gt;</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributor_covenant_code_of_conduct"><a class="anchor" href="#_contributor_covenant_code_of_conduct"></a>Appendix C: Contributor Covenant Code of Conduct</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_our_pledge"><a class="anchor" href="#_our_pledge"></a>C.1. Our Pledge</h3>
<div class="paragraph">
<p>In the interest of fostering an open and welcoming environment, we as contributors and maintainers
pledge to making participation in our project and our community a harassment-free experience for everyone,
regardless of age, body size, disability, ethnicity, gender identity and expression, level of experience,
nationality, personal appearance, race, religion, or sexual identity and orientation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_our_standards"><a class="anchor" href="#_our_standards"></a>C.2. Our Standards</h3>
<div class="paragraph">
<p>Examples of behavior that contributes to creating a positive environment include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using welcoming and inclusive language</p>
</li>
<li>
<p>Being respectful of differing viewpoints and experiences</p>
</li>
<li>
<p>Gracefully accepting constructive criticism</p>
</li>
<li>
<p>Focusing on what is best for the community</p>
</li>
<li>
<p>Showing empathy towards other community members</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examples of unacceptable behavior by participants include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The use of sexualized language or imagery and unwelcome sexual attention or advances</p>
</li>
<li>
<p>Trolling, insulting/derogatory comments, and personal or political attacks</p>
</li>
<li>
<p>Public or private harassment</p>
</li>
<li>
<p>Publishing others' private information, such as a physical or electronic address, without explicit permission</p>
</li>
<li>
<p>Other conduct which could reasonably be considered inappropriate in a professional setting</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_our_responsibilities"><a class="anchor" href="#_our_responsibilities"></a>C.3. Our Responsibilities</h3>
<div class="paragraph">
<p>Project maintainers are responsible for clarifying the standards of acceptable behavior and are expected to
take appropriate and fair corrective action in response to any instances of unacceptable behavior.</p>
</div>
<div class="paragraph">
<p>Project maintainers have the right and responsibility to remove, edit, or reject comments, commits,
code, wiki edits, issues, and other contributions that are not aligned to this Code of Conduct, or to ban
temporarily or permanently any contributor for other behaviors that they deem inappropriate, threatening,
offensive, or harmful.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scope"><a class="anchor" href="#_scope"></a>C.4. Scope</h3>
<div class="paragraph">
<p>This Code of Conduct applies both within project spaces and in public spaces when an individual is representing
the project or its community. Examples of representing a project or community include using an official project
e-mail address, posting via an official social media account, or acting as an appointed representative at an
online or offline event. Representation of a project may be further defined and clarified by project maintainers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_enforcement"><a class="anchor" href="#_enforcement"></a>C.5. Enforcement</h3>
<div class="paragraph">
<p>Instances of abusive, harassing, or otherwise unacceptable behavior may be reported by contacting the project
team at <a href="mailto:devs@codamic.tech">devs@codamic.tech</a>. The project team will review and investigate all complaints, and will respond in
a way that it deems appropriate to the circumstances. The project team is obligated to maintain confidentiality
with regard to the reporter of an incident. Further details of specific enforcement policies may be posted separately.</p>
</div>
<div class="paragraph">
<p>Project maintainers who do not follow or enforce the Code of Conduct in good faith may face temporary or permanent
repercussions as determined by other members of the project&#8217;s leadership.</p>
</div>
</div>
<div class="sect2">
<h3 id="_attribution"><a class="anchor" href="#_attribution"></a>C.6. Attribution</h3>
<div class="paragraph">
<p>This Code of Conduct is adapted from the [Contributor Covenant][homepage], version 1.4, available at <a href="http://contributor-covenant.org/version/1/4">version</a></p>
</div>
<div class="paragraph">
<p><a href="http://contributor-covenant.org">homepage</a>
<a href="http://contributor-covenant.org/version/1/4/">version</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_colophon"><a class="anchor" href="#_colophon"></a>Colophon</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The HellHound User Manual</p>
</div>
<div class="paragraph">
<p>&#169; 2017 by Sameer Rahmani &lt;<a href="mailto:lxsameer@gnu.org">lxsameer@gnu.org</a>&gt;</p>
</div>
<div class="paragraph">
<p>Created in Asciidoctor, Debian Unstable and FG42 Editor.</p>
</div>
</div>
</div>
</div>
<footer id="footer">
  Copyright <a href="//codamic.tech">Codamic Technologies</a> - 2017
</footer>
</body>
</html>